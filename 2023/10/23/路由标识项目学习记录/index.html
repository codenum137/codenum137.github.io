

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/H.png">
  <link rel="icon" href="/img/H.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="hey137">
  <meta name="keywords" content="">
  
    <meta name="description" content="记录在路由标识中学到的知识。">
<meta property="og:type" content="article">
<meta property="og:title" content="路由标识项目学习记录">
<meta property="og:url" content="https://codenum137.github.io/codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="Hey~">
<meta property="og:description" content="记录在路由标识中学到的知识。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231207191205122.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231018170506585.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126103233938.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126103253488.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231023135106710.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241120111942004.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126111746925.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231218153819693.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231120152630696.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240302133745076.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102132525764.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102132612024.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231110133046953.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231110133117432.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231107131449090.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102144701101.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102145308528.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102150102198.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240325163606930.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231106183417418.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240112201139468.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240112201243723.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240112201412783.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240318150055618.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231107121044655.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231107130258825.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231107130825682.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240108210707405.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240108210729069.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240415105954981.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231214121742240.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241021144217029.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125155602492.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125160521387.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125160616662.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125161215585.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125161236418.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241021144643328.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125110147812.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125110254727.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125161909767.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125161943211.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126104338519.png">
<meta property="og:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126104149243.png">
<meta property="article:published_time" content="2023-10-23T03:00:14.000Z">
<meta property="article:modified_time" content="2024-12-17T09:47:06.405Z">
<meta property="article:author" content="hey137">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="shell">
<meta property="article:tag" content="debian">
<meta property="article:tag" content="gns3">
<meta property="article:tag" content="sonic">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://codenum137.github.io/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231207191205122.png">
  
  
  
  <title>路由标识项目学习记录 - Hey~</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="https://lib.baomitu.com/font-awesome/6.1.2/css/all.min.css">
<link rel="stylesheet" href="/css/code-collapse.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"codenum137.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"VUZA7v64z7VyTAP8IacQddb3-gzGzoHsz","app_key":"s9nmj2bQKMeENVBm24I948wx","server_url":"https://vuza7v64.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Hey~</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="路由标识项目学习记录"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-10-23 11:00" pubdate>
          2023年10月23日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          37k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          312 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span>次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">路由标识项目学习记录</h1>
            
            
              <div class="markdown-body">
                
                <h1>路由标识</h1>
<h2 id="docker">docker</h2>
<h3 id="dockerfile">dockerfile</h3>
<ul>
<li>
<p>build</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker build -t authserver_ubuntu:v3 .<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>run，<code>--network=host</code>是联网功能。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="language-bash"> -it --network=host authserver_ubuntu:v3</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>第一次尝试编写的dockerfile，重点在于下载libmysqlclient的库，运行时需要加&amp;，让程序后台运行，才能build成功。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> ubuntu<br><span class="hljs-keyword">MAINTAINER</span> hey &lt;<span class="hljs-number">3261575578</span>@qq.com&gt;<br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i s@/security.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i s@/deb.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i s@/snapshot.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install g++ -y</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install libmysqlclient-dev -y</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> /AuthServer</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . /AuthServer</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /AuthServer</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> /usr/bin/g++ -g main.cpp -o main -lpthread -I /AuthServer/include /AuthServer/res/*.cpp `mysql_config --cflags --libs`</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> ./main &amp;</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>dockerfile的编写可以去run你的基础映像，在里面尝试将代码编译好，然后同样步骤写到dockerfile中，但需要注意build有时无法联网的问题，本人通过修改dns得到解决。下面网站提到可根据docker版本同样添加<code>--network=host</code>，未来可尝试一下。</p>
<p><a target="_blank" rel="noopener" href="http://www.debugself.com/2018/01/17/docker_network/">docker build以及docker run时使用host网络的方法 | 源码先生的调试人生 (debugself.com)</a></p>
<ul>
<li>
<p>DNS有问题</p>
<p><strong>能ping通ip地址但不能ping通域名</strong></p>
<p>编辑<code>/etc/docker/daemon.json</code>文件，添加dns信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;dns&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;114.114.114.114&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;8.8.8.8&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="基于已有容器创建新镜像">基于已有容器创建新镜像</h3>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">docker <span class="hljs-keyword">exec</span> -it -net=tap &lt;<span class="hljs-keyword">container</span>&gt; <br></code></pre></td></tr></table></figure>
<h2 id="debian">debian</h2>
<h3 id="在gns3添加debian终端">在gns3添加debian终端</h3>
<ol>
<li>
<p><a target="_blank" rel="noopener" href="https://gns3.com/marketplace/appliances%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F(.qcow2)%E5%92%8C%E5%BC%95%E5%AF%BC%E6%96%87%E4%BB%B6(.gns3a)">https://gns3.com/marketplace/appliances下载镜像(.qcow2)和引导文件(.gns3a)</a></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231207191205122.png" srcset="/img/loading.gif" lazyload alt="image-20231207191205122"></p>
</li>
</ol>
<h3 id="扩容">扩容</h3>
<ol>
<li>
<p>确保路由器接入公网，即与NAT相连。</p>
</li>
<li>
<p>右键路由器-&gt;configure-&gt;HDD-&gt;Resize，注意resize直接是increase</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231018170506585.png" srcset="/img/loading.gif" lazyload alt="image-20231018170506585"></p>
</li>
<li>
<p>参考以下网站解决。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jrri/p/16591351.html">Debian Linux磁盘扩容 - Jrri - 博客园 (cnblogs.com)</a></p>
</li>
<li>
<p>install时出错：unable to parse xxx可参考以下网站解决。</p>
<p>[<a target="_blank" rel="noopener" href="https://itsfoss.com/unable-to-parse-package-file/">Solved] Unable to parse package file /var/lib/apt/lists (itsfoss.com)</a></p>
</li>
<li>
<p>简单可采用以下命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo -s<br>fdisk -l 查看文件系统在哪 或 <span class="hljs-built_in">df</span> -h 扩容主体 <br>apt install cloud-guest-utils 或 dpkg -i xxx.deb<br>growpart /dev/vda 3<br>resize2fs /dev/vda3<br><span class="hljs-built_in">df</span> -h 再次检查<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="配置静态路由">配置静态路由</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">up ip route add 192.168.2.0/24 via 192.168.0.2<br></code></pre></td></tr></table></figure>
<h3 id="配置ip和默认网关">配置ip和默认网关</h3>
<ol>
<li>
<p>执行下面指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo -s<br>vim /etc/network/interfaces<br><span class="hljs-comment"># 注释掉 &quot;source-directory /run/network/interfaces.d&quot; 这一行</span><br><span class="hljs-built_in">rm</span> /etc/network/interfaces.d/50-cloud-init<br><span class="hljs-comment"># 创建 &quot;/etc/network/interfaces.d/10-ens4&quot;</span><br>vim /etc/network/interfaces.d/10-ens4<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>添加内容,保存并退出编辑器</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">auto ens4<br>iface ens4 inet6 static<br>        address 2023:10::1/64<br>        gateway 2023:10::11 <span class="hljs-comment">#注意此处不能有/64，否则sudo systemctl restart networking会失败</span><br>iface ens4 inet static<br>        address 10.10.10.11/24<br>up ip route add 10.10.0.0/16 via 10.10.10.21<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>重新启动网络服务使更改生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo systemctl restart networking<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>查看是否生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ip addr<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="增加网络接口">增加网络接口</h3>
<ol>
<li>
<p>首先增加网络适配器接口数量，右键config——adapter设置为2，用cloud/NAT（GNS3 VM）连接</p>
</li>
<li>
<p>编辑/etc/network/interfaces</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo vim /etc/network/interfaces<br></code></pre></td></tr></table></figure>
<p>添加内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">auto ens5<br>iface ens5 inet dhcp<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>重新启动网络服务使更改生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo systemctl restart networking<br></code></pre></td></tr></table></figure>
</li>
</ol>
<p>增加网络接口需注意默认网关是如何设置的，本项目中采取默认网关设为外网接口，配置静态路由将内网ip汇聚到内网接口上。</p>
<h2 id="sonic">sonic</h2>
<p>其实就是有sonic功能的debian，通过以下命令可以查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> /etc/issue<br></code></pre></td></tr></table></figure>
<h3 id="isisd开机自启动">isisd开机自启动</h3>
<h4 id="系统脚本">系统脚本</h4>
<ol>
<li>
<p>创建脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim docker_isisd.sh<br></code></pre></td></tr></table></figure>
<p>脚本内容如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; start_isisd.service</span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=Docker ISISD Service</span><br><span class="hljs-string">After=docker.service</span><br><span class="hljs-string">Requires=docker.service</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">ExecStart=/usr/bin/docker exec -i bgp /bin/bash -c &quot;/usr/lib/frr/isisd -A 127.0.0.1 -d&quot;</span><br><span class="hljs-string">Restart=always</span><br><span class="hljs-string">RestartSec=5</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br>sudo <span class="hljs-built_in">mv</span> start_isisd.service /etc/systemd/system/<br>sudo systemctl daemon-reload<br>sudo systemctl <span class="hljs-built_in">enable</span> start_isisd.service<br><br></code></pre></td></tr></table></figure>
<blockquote>
<p>here文档</p>
<p>如果你需要输入多行文本，可以使用Here文档（Here Document）来实现。Here文档允许你在脚本中直接定义多行文本，并将其写入文件。</p>
<p>下面是一个示例脚本，演示如何新建一个文件并输入多行文本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">复制代码<span class="hljs-comment">#!/bin/bash</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-comment"># 创建一个新文件并输入多行文本</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; myfile.txt</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">Hello, World!</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">This is line 2.</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">And this is line 3.</span></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash"><span class="hljs-string">EOF</span></span><br></code></pre></td></tr></table></figure>
<p>在上面的示例中，使用了<code>cat</code>命令和Here文档的语法。<code>&lt;&lt; EOF</code>表示开始定义Here文档，<code>EOF</code>表示结束Here文档。在这之间的内容就是要输入的多行文本。这里定义了三行文本，并将其写入到名为<code>myfile.txt</code>的文件中。</p>
<p>如果脚本执行成功，将会在当前目录下创建一个新的文件<code>myfile.txt</code>，其中包含三行文本。</p>
<p>请注意，Here文档中的EOF可以是任意标识符，只需保证开始和结束的标识符一致即可。</p>
</blockquote>
</li>
<li>
<p>增加权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo <span class="hljs-built_in">chmod</span> +x docker_isisd.sh<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>执行脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./docker_isisd.sh<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="修改bgp容器启动设置">修改bgp容器启动设置</h4>
<ol>
<li>
<p>进入bgp容器，进入<code>/usr/share/sonic/templates/supervisord/</code>目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">exec</span> -it bgp /bash/bin<br><span class="hljs-built_in">cd</span> /usr/share/sonic/templates/supervisord/<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>修改<code>supervisor.conf.j2</code>文件</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126103233938.png" srcset="/img/loading.gif" lazyload alt="image-20241126103233938"></p>
</li>
<li>
<p>修改<code>critical_processes.j2</code>文件</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126103253488.png" srcset="/img/loading.gif" lazyload alt="image-20241126103253488"></p>
</li>
</ol>
<h3 id="配置ip">配置ip</h3>
<p>指令如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo config interface ip add Ethernet0 2023:10::11/64<br>sudo config interface ip add Ethernet4 2023:11::11/64<br>sudo config interface startup Ethernet0<br>sudo config interface startup Ethernet4<br>show ipv6 interface<br>sudo config save<br></code></pre></td></tr></table></figure>
<h3 id="配置路由">配置路由</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo config route add prefix 2.2.3.4/32 nexthop 30.0.0.9<br></code></pre></td></tr></table></figure>
<h3 id="配置isis">配置isis</h3>
<p>指令如下，注意在GNS3里，sonic-vs内部接口编号对应GNS3拓扑里接口编号×4。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo docker <span class="hljs-built_in">exec</span> -it bgp /bin/bash<br>/usr/lib/frr/isisd -A 127.0.0.1 -d <span class="hljs-comment"># 在bgp容器中启动ISIS</span><br>vtysh进入配置界面<br><span class="hljs-comment"># 配置isis域和所有需要配isis协议的接口</span><br>configure<br>ro isis sonic <span class="hljs-comment"># 这里的 sonic 可以修改，但要与后面的 interface 中的配置保持一</span><br>致。不同路由器可以使用相同的命名<br>net 49.0001.1111.1111.1111.00 <span class="hljs-comment"># 这里设置路由器的 NSAP 地址，可以设置为 49.0001.xxxx.xxxx.xxxx.00</span><br>end<br>configure<br>interface Ethernet0<br>ipv6 ro isis sonic <span class="hljs-comment"># ipv4 对应的命令为 ip ro isis sonic</span><br>end<br>configure<br>interface Ethernet4<br>ipv6 ro isis sonic <span class="hljs-comment"># ipv4 对应的命令为 ip ro isis sonic</span><br>end<br>write<br></code></pre></td></tr></table></figure>
<h3 id="配置ospf">配置ospf</h3>
<ol>
<li>
<p>启动ospfd</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/docker <span class="hljs-built_in">exec</span> -i bgp /bin/bash -c <span class="hljs-string">&quot;/usr/lib/frr/ospfd -A 127.0.0.1 -d&quot;</span><br></code></pre></td></tr></table></figure>
<p>若想同时启动isisd和ospfd</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/docker <span class="hljs-built_in">exec</span> -i bgp /bin/bash -c <span class="hljs-string">&quot;/usr/lib/frr/isisd -A 127.0.0.1 -d</span><br><span class="hljs-string">/usr/lib/frr/ospfd -A 127.0.0.1 -d&quot;</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>配置ospf</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vtysh<br>config<br>ro ospf<br>net 10.2.3.3/24 area 0 <span class="hljs-comment"># 在10.2.3.3端口上开启ospf，区域号为0</span><br>end<br>write<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="重启lldp">重启lldp</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo systemctl restart lldp<br></code></pre></td></tr></table></figure>
<h3 id="配置自动登出时间">配置自动登出时间</h3>
<ol>
<li>
<p>TMOUT已存在</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo -s<br>grep -q TMOUT=3600 /etc/profile  || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;TMOUT=3600&quot;</span> &gt;&gt; /etc/profile<br>sed -i <span class="hljs-string">&#x27;s/^TMOUT=.*/TMOUT=3600/g&#x27;</span> /etc/profile<br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>TMOUT不存在</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo -s<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;TMOUT=432000&quot;</span> &gt;&gt; /etc/profile<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;export TMOUT&quot;</span> &gt;&gt; /etc/profile<br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="自动化配置ip，isis">自动化配置ip，isis</h3>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231023135106710.png" srcset="/img/loading.gif" lazyload alt="image-20231023135106710"></p>
<ul>
<li>
<p>利用sed -i命令去编辑interfaces文件</p>
<p>注释</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed -i -e <span class="hljs-string">&#x27;s/source-directory \/run/# source-directory \/run/g&#x27;</span> /etc/network/interfaces<br></code></pre></td></tr></table></figure>
<p>添加内容，在第8行后添加</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed -i -e <span class="hljs-string">&#x27;8a </span><br><span class="hljs-string">auto ens5</span><br><span class="hljs-string">iface ens5 inet dhcp&#x27;</span> /etc/network/interfaces<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>脚本文件中使用sudo -s会中断脚本，故直接sudo 命令比较好。</p>
</li>
<li>
<p>sudo cat &lt;&lt; EOF &gt; 10-ens4无法在权限文件夹创建10-ens4，故需要修改上级目录的权限</p>
</li>
<li>
<p>vtysh无法通过echo -e “xxx” | vtysh和here文档来交互，但可以通过-c命令来解决。</p>
</li>
</ul>
<p>部署步骤：</p>
<ol>
<li>
<p>创建脚本后复制对应脚本内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim init.sh<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>增加权限。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo <span class="hljs-built_in">chmod</span> +x init.sh<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>运行脚本。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./init.sh<br></code></pre></td></tr></table></figure>
</li>
</ol>
<p>另路由器初始账号密码</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">admin<br></code></pre></td></tr></table></figure>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">YourPaSsWoRd<br></code></pre></td></tr></table></figure>
<p>终端账号密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">debian<br></code></pre></td></tr></table></figure>
<hr>
<ul>
<li>更新环回地址</li>
<li>更新一键复制即可配置</li>
</ul>
<hr>
<ul>
<li>更新在主机上一键配置，通过telnet来实现，要求按顺序部署gns3上的路由器和终端，先路由器，后终端</li>
<li>若是在windows生成的文件放到linux执行，需要dos2unix转换一下</li>
</ul>
<hr>
<ul>
<li>
<p>更新使用python中的telnetlib来实现对多路由器的命令执行，这样在windows和linux上都可以快速部署。</p>
</li>
<li>
<p>参考</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gmpy/p/11796416.html">python argparse：命令行参数解析详解 - 广漠飘羽 - 博客园 (cnblogs.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/RudeTomatoes/article/details/117003291">python之argparse模块常见用法包含实例(超详细)_python required属性-CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://lanyiyun.blog.csdn.net/article/details/136049472?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~YuanLiJiHua~Position-2-136049472-blog-117910697.235%5Ev43%5Epc_blog_bottom_relevance_base9&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~YuanLiJiHua~Position-2-136049472-blog-117910697.235%5Ev43%5Epc_blog_bottom_relevance_base9&amp;utm_relevant_index=3">python telnetlib详解-CSDN博客</a></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> telnetlib<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> argparse<br><br>SEP = os.sep<br><br>parser = argparse.ArgumentParser(description=<span class="hljs-string">&quot;telnet gns3 router and execute command&quot;</span>)<br>parser.add_argument(<span class="hljs-string">&#x27;-H&#x27;</span>, <span class="hljs-string">&#x27;--host&#x27;</span>, default=<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;gns3 or gns3vm ip&quot;</span>)<br>parser.add_argument(<span class="hljs-string">&#x27;-n&#x27;</span>, <span class="hljs-string">&#x27;--num&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, required=<span class="hljs-literal">True</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;number of router&quot;</span>)<br>parser.add_argument(<span class="hljs-string">&#x27;-s&#x27;</span>, <span class="hljs-string">&#x27;--start_rid&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;start router ID when init&quot;</span>)<br>parser.add_argument(<span class="hljs-string">&#x27;-P&#x27;</span>, <span class="hljs-string">&#x27;--port&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">5000</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;start gns3 port&quot;</span>)<br>parser.add_argument(<span class="hljs-string">&#x27;-p&#x27;</span>, <span class="hljs-string">&#x27;--password&#x27;</span>, default=<span class="hljs-string">&quot;YourPaSsWoRd&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;login password&quot;</span>)<br>parser.add_argument(<span class="hljs-string">&#x27;-f&#x27;</span>, <span class="hljs-string">&#x27;--cmd_file&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;command file&quot;</span>)<br>parser.add_argument(<span class="hljs-string">&#x27;-i&#x27;</span>, <span class="hljs-string">&#x27;--init&#x27;</span>, action=<span class="hljs-string">&#x27;store_true&#x27;</span>)<br>args = parser.parse_args()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">if</span> args.init:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(args.num):<br>            tn = telnetlib.Telnet(args.host, args.port + i * <span class="hljs-number">2</span>)<br>            tn.write(<span class="hljs-string">b&quot;admin\n&quot;</span>)<br>            time.sleep(<span class="hljs-number">0.01</span>)<br>            tn.write(args.password.encode(<span class="hljs-string">&quot;ascii&quot;</span>) + <span class="hljs-string">b&quot;\n&quot;</span>)<br>            time.sleep(<span class="hljs-number">0.01</span>)<br>            route_sh = <span class="hljs-string">&quot;out&quot;</span> + SEP + <span class="hljs-string">&quot;r&quot;</span> + <span class="hljs-built_in">str</span>(args.start + i) + <span class="hljs-string">&quot;.sh&quot;</span><br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(route_sh, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>                    tn.write(line.encode(<span class="hljs-string">&quot;ascii&quot;</span>) + <span class="hljs-string">b&quot;\n&quot;</span>)<br>                    time.sleep(<span class="hljs-number">0.01</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\r&quot;</span>+<span class="hljs-string">&quot;Process: %d / %d&quot;</span>%(i+<span class="hljs-number">1</span>,args.num),end=<span class="hljs-string">&quot;&quot;</span>,flush=<span class="hljs-literal">True</span>)<br>            tn.close()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(args.num):<br>            tn = telnetlib.Telnet(args.host, args.port + i * <span class="hljs-number">2</span>)<br>            tn.write(<span class="hljs-string">b&quot;admin\n&quot;</span>)<br>            time.sleep(<span class="hljs-number">0.01</span>)<br>            tn.write(args.password.encode(<span class="hljs-string">&quot;ascii&quot;</span>) + <span class="hljs-string">b&quot;\n&quot;</span>)<br>            time.sleep(<span class="hljs-number">0.01</span>)<br>            tn.write(<span class="hljs-string">b&quot;sudo -s\n&quot;</span>)<br>            time.sleep(<span class="hljs-number">0.01</span>)<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(args.cmd_file, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                cmd=<span class="hljs-string">&quot;&quot;</span><br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>                    line=line.rstrip()<br>                    <span class="hljs-keyword">if</span> cmd == <span class="hljs-string">&quot;&quot;</span>:<br>                        cmd +=line<br>                    <span class="hljs-keyword">else</span>:<br>                        cmd += <span class="hljs-string">&quot; &amp;&amp; &quot;</span>+line<br>                    time.sleep(<span class="hljs-number">0.01</span>)<br>                tn.write(cmd.encode(<span class="hljs-string">&quot;ascii&quot;</span>) + <span class="hljs-string">b&quot;\n&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\r&quot;</span>+<span class="hljs-string">&quot;Process: %d / %d&quot;</span>%(i+<span class="hljs-number">1</span>,args.num),end=<span class="hljs-string">&quot;&quot;</span>,flush=<span class="hljs-literal">True</span>)<br>            tn.close()<br><br></code></pre></td></tr></table></figure>
<p>附上代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># author: hey137</span><br><span class="hljs-keyword">import</span> os.path<br><br>ROUTE_NUM = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入路由器数目\n&quot;</span>))<br>TERM_NUM = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入终端数目\n&quot;</span>))<br>SEP = os.sep<br>OUT_PATH = <span class="hljs-string">&quot;.&quot;</span> + SEP + <span class="hljs-string">&quot;out&quot;</span><br>password = <span class="hljs-string">&quot;123&quot;</span><br>MTU = <span class="hljs-number">9000</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_dir</span>(<span class="hljs-params">path</span>):<br>    folder = os.path.exists(path)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> folder:<br>        os.makedirs(path)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_ipv4</span>(<span class="hljs-params">my_id, oid, mask</span>):<br>    <span class="hljs-keyword">if</span> my_id &lt; oid:<br>        ip = <span class="hljs-string">&quot;10.&quot;</span> + <span class="hljs-built_in">str</span>(my_id) + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-built_in">str</span>(oid) + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-built_in">str</span>(my_id)<br>    <span class="hljs-keyword">else</span>:<br>        ip = <span class="hljs-string">&quot;10.&quot;</span> + <span class="hljs-built_in">str</span>(oid) + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-built_in">str</span>(my_id) + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-built_in">str</span>(my_id)<br>    <span class="hljs-keyword">if</span> mask &gt; <span class="hljs-number">0</span>:<br>        ip = ip + <span class="hljs-string">&quot;/&quot;</span> + <span class="hljs-built_in">str</span>(mask)<br>    <span class="hljs-keyword">return</span> ip<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_ipv6</span>(<span class="hljs-params">my_id, oid, mask</span>):<br>    <span class="hljs-keyword">if</span> my_id &lt; oid:<br>        ip = <span class="hljs-string">&quot;2023:&quot;</span> + <span class="hljs-built_in">str</span>(my_id) + <span class="hljs-string">&quot;:&quot;</span> + <span class="hljs-built_in">str</span>(oid) + <span class="hljs-string">&quot;::&quot;</span> + <span class="hljs-built_in">str</span>(my_id)<br>    <span class="hljs-keyword">else</span>:<br>        ip = <span class="hljs-string">&quot;2023:&quot;</span> + <span class="hljs-built_in">str</span>(oid) + <span class="hljs-string">&quot;:&quot;</span> + <span class="hljs-built_in">str</span>(my_id) + <span class="hljs-string">&quot;::&quot;</span> + <span class="hljs-built_in">str</span>(my_id)<br>    <span class="hljs-keyword">if</span> mask &gt; <span class="hljs-number">0</span>:<br>        ip = ip + <span class="hljs-string">&quot;/&quot;</span> + <span class="hljs-built_in">str</span>(mask)<br>    <span class="hljs-keyword">return</span> ip<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Terminal</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, tid</span>):<br>        <span class="hljs-comment"># tid:term_id</span><br>        self.oid = <span class="hljs-literal">None</span><br>        self.<span class="hljs-built_in">id</span> = tid + ROUTE_NUM<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_ens4_route</span>(<span class="hljs-params">self, oid</span>):<br>        self.oid = oid<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">make_sh</span>(<span class="hljs-params">self</span>):<br>        file_name = OUT_PATH + SEP + <span class="hljs-string">&quot;t&quot;</span> + <span class="hljs-built_in">str</span>(self.<span class="hljs-built_in">id</span> - ROUTE_NUM) + <span class="hljs-string">&quot;.sh&quot;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-comment"># 一键复制</span><br>            f.write(<span class="hljs-string">&quot;cat &lt;&lt; EOFSH &gt; init.sh\n&quot;</span>)<br>            pre_order = \<br>                <span class="hljs-string">&quot;&quot;&quot;sudo sed -i -e &#x27;s/source-directory \\/run/# source-directory \\/run/g&#x27; /etc/network/interfaces</span><br><span class="hljs-string">sudo sed -i -e &#x27;8a auto ens5\\niface ens5 inet dhcp&#x27; /etc/network/interfaces</span><br><span class="hljs-string">sudo rm /etc/network/interfaces.d/50-cloud-init</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>            f.write(pre_order)<br>            <span class="hljs-comment"># 修改权限</span><br>            chmod = <span class="hljs-string">&quot;sudo chmod 777 /etc/network/interfaces.d\n&quot;</span><br>            f.write(chmod)<br>            <span class="hljs-comment"># 配置ip和默认网关</span><br>            my_ipv6 = make_ipv6(self.<span class="hljs-built_in">id</span>, self.oid, <span class="hljs-number">64</span>)<br>            o_ipv6 = make_ipv6(self.oid, self.<span class="hljs-built_in">id</span>, <span class="hljs-number">0</span>)<br>            ipv4 = make_ipv4(self.<span class="hljs-built_in">id</span>, self.oid, <span class="hljs-number">24</span>)<br>            o_ipv4 = make_ipv4(self.oid, self.<span class="hljs-built_in">id</span>, <span class="hljs-number">0</span>)<br>            ip_config = <span class="hljs-string">&quot;&quot;&quot;sudo cat &lt;&lt; EOF &gt; /etc/network/interfaces.d/10-ens4</span><br><span class="hljs-string">auto ens4</span><br><span class="hljs-string">iface ens4 inet6 static</span><br><span class="hljs-string">address &quot;&quot;&quot;</span> + my_ipv6 + <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">gateway &quot;&quot;&quot;</span> + o_ipv6 + <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">iface ens4 inet static</span><br><span class="hljs-string">address &quot;&quot;&quot;</span> + ipv4 + <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">mtu &quot;&quot;&quot;</span> + <span class="hljs-built_in">str</span>(MTU) + <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">up ip route add 10.0.0.0/8 via &quot;&quot;&quot;</span> + o_ipv4 + <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">EOF</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>            f.write(ip_config)<br>            restart_net = <span class="hljs-string">&quot;sudo systemctl restart networking\n&quot;</span><br>            f.write(restart_net)<br>            f.write(<span class="hljs-string">&quot;EOFSH\nchmod +x init.sh\n./init.sh\n&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Router</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, rid</span>):<br>        <span class="hljs-comment"># rid:router_id</span><br>        self.inter_map = &#123;&#125;<br>        self.<span class="hljs-built_in">id</span> = rid<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_edge</span>(<span class="hljs-params">self, _inter, oid</span>):<br>        <span class="hljs-comment"># oid:other_id</span><br>        self.inter_map[_inter] = oid<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">make_sh</span>(<span class="hljs-params">self</span>):<br>        file_name = OUT_PATH + SEP + <span class="hljs-string">&quot;r&quot;</span> + <span class="hljs-built_in">str</span>(self.<span class="hljs-built_in">id</span>) + <span class="hljs-string">&quot;.sh&quot;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-comment"># 一键复制</span><br>            f.write(<span class="hljs-string">&quot;cat &lt;&lt; EOFSH &gt; init.sh\n&quot;</span>)<br>            <span class="hljs-comment"># 修改密码</span><br>            change_passwd = <span class="hljs-string">&quot;echo -e \&quot;&quot;</span> + password + <span class="hljs-string">&quot;\n&quot;</span> + password + <span class="hljs-string">&quot;\n\&quot; | sudo passwd admin\n&quot;</span><br>            f.write(change_passwd)<br>            <span class="hljs-comment"># 配置isis自启动</span><br>            start_isis = <span class="hljs-string">&quot;&quot;&quot;cat &lt;&lt; EOF &gt; start_isisd.service</span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=Docker ISISD Service</span><br><span class="hljs-string">After=docker.service</span><br><span class="hljs-string">Requires=docker.service</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">ExecStart=/usr/bin/docker exec -i bgp /bin/bash -c &quot;/usr/lib/frr/isisd -A 127.0.0.1 -d&quot;</span><br><span class="hljs-string">Restart=always</span><br><span class="hljs-string">RestartSec=5</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br><span class="hljs-string">sudo mv start_isisd.service /etc/systemd/system/</span><br><span class="hljs-string">sudo systemctl daemon-reload</span><br><span class="hljs-string">sudo systemctl enable start_isisd.service</span><br><span class="hljs-string">/usr/bin/docker exec -i bgp /bin/bash -c &quot;/usr/lib/frr/isisd -A 127.0.0.1 -d&quot;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>            f.write(start_isis)<br>            <span class="hljs-comment"># 配置ip</span><br>            <span class="hljs-keyword">for</span> _inter, oid <span class="hljs-keyword">in</span> self.inter_map.items():<br>                old_id = <span class="hljs-string">&quot;10.0.0.&quot;</span> + <span class="hljs-built_in">str</span>(_inter * <span class="hljs-number">2</span>) + <span class="hljs-string">&quot;/31&quot;</span><br>                ipv4 = make_ipv4(self.<span class="hljs-built_in">id</span>, oid, <span class="hljs-number">24</span>)<br>                ipv6 = make_ipv6(self.<span class="hljs-built_in">id</span>, oid, <span class="hljs-number">64</span>)<br>                remove_ip = <span class="hljs-string">&quot;sudo config interface ip remove Ethernet&quot;</span> + <span class="hljs-built_in">str</span>(_inter * <span class="hljs-number">4</span>) + <span class="hljs-string">&quot; &quot;</span> + old_id + <span class="hljs-string">&quot;\n&quot;</span><br>                add_ipv4 = <span class="hljs-string">&quot;sudo config interface ip add Ethernet&quot;</span> + <span class="hljs-built_in">str</span>(_inter * <span class="hljs-number">4</span>) + <span class="hljs-string">&quot; &quot;</span> + ipv4 + <span class="hljs-string">&quot;\n&quot;</span><br>                add_ipv6 = <span class="hljs-string">&quot;sudo config interface ip add Ethernet&quot;</span> + <span class="hljs-built_in">str</span>(_inter * <span class="hljs-number">4</span>) + <span class="hljs-string">&quot; &quot;</span> + ipv6 + <span class="hljs-string">&quot;\n&quot;</span><br>                change_mtu = <span class="hljs-string">&quot;sudo config interface mtu Ethernet&quot;</span> + <span class="hljs-built_in">str</span>(_inter * <span class="hljs-number">4</span>) + <span class="hljs-string">&quot; &quot;</span> + <span class="hljs-built_in">str</span>(MTU) + <span class="hljs-string">&quot;\n&quot;</span><br>                start_up = <span class="hljs-string">&quot;sudo config interface startup Ethernet&quot;</span> + <span class="hljs-built_in">str</span>(_inter * <span class="hljs-number">4</span>) + <span class="hljs-string">&quot;\n&quot;</span><br>                f.write(remove_ip)<br>                f.write(add_ipv4)<br>                f.write(add_ipv6)<br>                f.write(change_mtu)<br>                f.write(start_up)<br>            <span class="hljs-comment"># loopback_ipv6 = &quot;2023:&quot; + str(self.id) + &quot;::1&quot;</span><br>            <span class="hljs-comment"># add_loopback = &quot;sudo config interface ip add Loopback0&quot; + &quot; &quot; + loopback_ipv6 + &quot;\n&quot;</span><br>            <span class="hljs-comment"># f.write(add_loopback)</span><br>            save = <span class="hljs-string">&quot;sudo config save -y\n&quot;</span><br>            f.write(save)<br>            <span class="hljs-comment"># 配置isis</span><br>            pre_order = <span class="hljs-string">&quot;&quot;&quot;vtysh -c &quot;</span><br><span class="hljs-string">config</span><br><span class="hljs-string">ro isis sonic</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>            <span class="hljs-comment"># net 49.0001.0000.0000.str(rid)(左边补齐0).00</span><br>            net = <span class="hljs-string">&quot;net 49.0001.0000.0000.&quot;</span> + <span class="hljs-string">&quot;0&quot;</span> * (<span class="hljs-number">4</span> - <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>(self.<span class="hljs-built_in">id</span>))) + <span class="hljs-built_in">str</span>(self.<span class="hljs-built_in">id</span>) + <span class="hljs-string">&quot;.00\n&quot;</span><br>            f.write(pre_order)<br>            f.write(net)<br>            <span class="hljs-keyword">for</span> _inter <span class="hljs-keyword">in</span> self.inter_map.keys():<br>                enter_inter = <span class="hljs-string">&quot;interface Ethernet&quot;</span> + <span class="hljs-built_in">str</span>(_inter * <span class="hljs-number">4</span>) + <span class="hljs-string">&quot;\n&quot;</span><br>                isis = <span class="hljs-string">&quot;ipv6 ro isis sonic\nip ro isis sonic\n&quot;</span><br>                lfa = <span class="hljs-string">&quot;isis fast-reroute lfa\n&quot;</span><br>                f.write(enter_inter)<br>                f.write(isis)<br>                f.write(lfa)<br>                f.write(<span class="hljs-string">&quot;exit\n&quot;</span>)<br>            <span class="hljs-comment"># f.write(&quot;interface Loopback0\nipv6 ro isis sonic\n&quot;)</span><br>            f.write(<span class="hljs-string">&quot;end\n&quot;</span>)<br>            f.write(<span class="hljs-string">&quot;write\&quot;\n&quot;</span>)<br>            f.write(<span class="hljs-string">&quot;EOFSH\nchmod +x init.sh\n./init.sh\n&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">echo_line</span>(<span class="hljs-params">cmd_str</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;echo \&quot;&quot;</span> + cmd_str + <span class="hljs-string">&quot;\&quot;\nsleep 1 \n&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_linux_host_sh</span>():<br>    file_name = OUT_PATH + SEP + <span class="hljs-string">&quot;linux_host.sh&quot;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_name, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(<span class="hljs-string">&quot;#!/bin/bash\n&quot;</span>)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, ROUTE_NUM + <span class="hljs-number">1</span>):<br>            f.write(<span class="hljs-string">&quot;# r&quot;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&quot;\n(\n&quot;</span>)<br>            f.write(echo_line(<span class="hljs-string">&quot;admin&quot;</span>))<br>            f.write(echo_line(<span class="hljs-string">&quot;YourPaSsWoRd&quot;</span>))<br>            f.write(<span class="hljs-string">&quot;cmd=$(sed &#x27;/chmod/q&#x27; r&quot;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&quot;.sh)\n&quot;</span>)<br>            f.write(echo_line(<span class="hljs-string">&quot;$cmd&quot;</span>))<br>            f.write(echo_line(<span class="hljs-string">&quot;chmod +x init.sh&quot;</span>))<br>            f.write(echo_line(<span class="hljs-string">&quot;./init.sh&quot;</span>))<br>            f.write(<span class="hljs-string">&quot;) | telnet 127.0.0.1 &quot;</span>+<span class="hljs-built_in">str</span>(<span class="hljs-number">5000</span>+<span class="hljs-number">2</span>*(i-<span class="hljs-number">1</span>))+<span class="hljs-string">&quot;\n\n&quot;</span>)<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    make_dir(OUT_PATH)<br>    router = [Router(<span class="hljs-number">0</span>)]<br>    term = [Terminal(<span class="hljs-number">0</span>)]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, ROUTE_NUM + <span class="hljs-number">1</span>):<br>        router.append(Router(i))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TERM_NUM + <span class="hljs-number">1</span>):<br>        term.append(Terminal(i))<br>    <span class="hljs-keyword">if</span> TERM_NUM &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;请输入&quot;</span> + <span class="hljs-built_in">str</span>(TERM_NUM) + <span class="hljs-string">&quot;条终端链路信息 格式：（终端n通过路由器a的ei接口与路由器a相连 n inter_ei aID)&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(TERM_NUM):<br>        edge = <span class="hljs-built_in">input</span>()<br>        term_id, inter, r_id = edge.split()<br>        term_id = <span class="hljs-built_in">int</span>(term_id)<br>        r_id = <span class="hljs-built_in">int</span>(r_id)<br>        inter = <span class="hljs-built_in">int</span>(inter)<br>        term[term_id].add_ens4_route(r_id)<br>        router[r_id].add_edge(inter, term[term_id].<span class="hljs-built_in">id</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;请输入路由链路信息，以空行结尾 格式：（路由器a的ei接口与路由器b的ej接口相连aID inter_ei inter_ej bID）&quot;</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        edge = <span class="hljs-built_in">input</span>()<br>        <span class="hljs-keyword">if</span> edge == <span class="hljs-string">&quot;&quot;</span>:<br>            <span class="hljs-keyword">break</span><br>        s_router, s_inter, d_inter, d_router = edge.split()<br>        s_router = <span class="hljs-built_in">int</span>(s_router)<br>        s_inter = <span class="hljs-built_in">int</span>(s_inter)<br>        d_router = <span class="hljs-built_in">int</span>(d_router)<br>        d_inter = <span class="hljs-built_in">int</span>(d_inter)<br>        router[s_router].add_edge(s_inter, d_router)<br>        router[d_router].add_edge(d_inter, s_router)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, ROUTE_NUM + <span class="hljs-number">1</span>):<br>        router[i].make_sh()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, TERM_NUM + <span class="hljs-number">1</span>):<br>        term[i].make_sh()<br><br>    make_linux_host_sh()<br><br></code></pre></td></tr></table></figure>
<h3 id="配置PBR">配置PBR</h3>
<p>用于解决有时ISIS路由inactive导致的无法连通，目的在于实现10.0.0.0/8以外的目的地址都通过eth0。但目前isis路由inactive的触发条件没有找到，似乎是eth0连接nat后可可能将eth0作为默认路由导致10.0.0.0/8中的地址也去eth0，故ping不通。</p>
<h4 id="配置">配置</h4>
<p>如果你希望实现除了10.0.0.0/8的其他网络使用eth0作为默认网关，而10.0.0.0/8网段有多个网关处理的情况，可以考虑使用Policy-Based Routing（PBR）来实现。</p>
<p>PBR允许你基于源IP地址、目标IP地址、源端口、目标端口或其他匹配条件，来选择不同的路由策略。在这种情况下，你可以设置一个PBR规则，让除了10.0.0.0/8的其他网络流量使用eth0作为默认网关。</p>
<p>下面是一个简单的PBR配置示例：</p>
<ol>
<li>
<p>创建一个新的路由表，比如表号为100：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;100    eth0&quot;</span> &gt;&gt; /etc/iproute2/rt_tables<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>设置PBR规则，让除了10.0.0.0/8的其他网络流量使用新的路由表：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ip rule add from 10.0.0.0/8 table main<br>ip rule add from all table 100<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>在新的路由表（表号为100）中添加默认路由，指向eth0网关：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ip route add default via &lt;eth0_gateway_ip&gt; dev eth0 table 100<br></code></pre></td></tr></table></figure>
</li>
</ol>
<p>这样配置后，除了10.0.0.0/8的其他网络流量将会使用eth0作为默认网关进行通信。</p>
<p>请替换<code>&lt;eth0_gateway_ip&gt;</code>为你实际的eth0网关IP地址。</p>
<p>完成以上配置后，重新加载PBR规则并测试网络连接，确保配置生效。这样就可以实现除了10.0.0.0/8的其他网络使用eth0作为默认网关的功能。</p>
<h4 id="检查">检查</h4>
<ol>
<li>使用 <code>ip rule show</code> 命令来查看PBR规则是否正确设置。确保除了10.0.0.0/8的其他网络有一个规则指定使用新创建的路由表（table 100）。</li>
<li>使用 <code>ip route show table 100</code> 命令来查看新创建的路由表中是否包含了正确的默认路由，指向eth0网关。</li>
</ol>
<h3 id="sonic-p4-更换source源">sonic-p4 更换source源</h3>
<p>原本的源已经过期无法使用</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">deb http://snapshot.debian.org/archive/debian/20210326T030000Z jessie main<br></code></pre></td></tr></table></figure>
<h3 id="sonic内核版本更换">sonic内核版本更换</h3>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241120111942004.png" srcset="/img/loading.gif" lazyload alt="image-20241120111942004"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 添加源deb http://security.debian.org/debian-security bullseye-security main </span><br>sudo apt search linux-headers<br>sudo apt-get install linux-headers 下载最新可用的<br><span class="hljs-comment"># 修改Makefile文件</span><br></code></pre></td></tr></table></figure>
<h3 id="debian旧版本">debian旧版本</h3>
<ol>
<li>
<p><a target="_blank" rel="noopener" href="https://deb.sipwise.com/debian/pool/main/l/linux/">Index of /debian/pool/main/l/linux</a>搜索linux-headers-5.10.0-18，下载<code>linux-headers-5.10.0-18-common_5.10.140-1_all.deb</code></p>
</li>
<li>
<p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo dpkg -i linux-headers-5.10.0-18-common_5.10.140-1_all.deb<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="sonic架构">sonic架构</h3>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126111746925.png" srcset="/img/loading.gif" lazyload alt="image-20241126111746925"></p>
<h3 id="快速删除默认路由-添加vlan">快速删除默认路由&amp;添加vlan</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Create untagged vlan</span><br>sudo config vlan add 2<br><br><span class="hljs-comment"># Add IP to vlan</span><br>sudo config interface ip add Vlan2 10.2.0.0/24<br><br><span class="hljs-comment"># Remove all default IP settings</span><br>show ip interfaces | <span class="hljs-built_in">tail</span> -n +3 | grep Ethernet | awk <span class="hljs-string">&#x27;&#123;print &quot;sudo config interface ip remove&quot;, $1, $2&#125;&#x27;</span> &gt; oobe.sh; <span class="hljs-built_in">chmod</span> +x oobe.sh; ./oobe.sh<br><br><span class="hljs-comment"># Add all ports to the new vlan</span><br>show interfaces status | <span class="hljs-built_in">tail</span> -n +3 | grep Ethernet | awk <span class="hljs-string">&#x27;&#123;print &quot;sudo config vlan member add -u 2&quot;, $1&#125;&#x27;</span> &gt; oobe.sh; <span class="hljs-built_in">chmod</span> +x oobe.sh; ./oobe.sh<br><br><span class="hljs-comment"># Enable proxy arp, so switch can respond to arp requests from hosts</span><br>sudo config vlan proxy_arp 2 enabled<br><br><span class="hljs-comment"># Save config, so it will be persistent after reboot</span><br>sudo config save -y<br></code></pre></td></tr></table></figure>
<h3 id="sonic-vpp">sonic-vpp</h3>
<p><a target="_blank" rel="noopener" href="https://ronnievsmith.medium.com/sonic-virtual-switch-with-fd-ios-vector-packet-processor-vpp-on-google-cloud-89f9c62f5fe3">SONiC Virtual Switch with FD.io Vector Packet Processor (VPP) on Google Cloud | by Ronnie Smith | Oct, 2024 | Medium</a></p>
<ul>
<li>如何拉取pause镜像<a target="_blank" rel="noopener" href="https://blog.csdn.net/catoop/article/details/124167797">国内拉取 gcr.io 镜像（Google Kubernetes 镜像）-CSDN博客</a></li>
</ul>
<blockquote>
<p>tun/tap设备是linux当中的虚拟网络设备，与之前提到的<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=131959650&amp;content_type=Article&amp;match_order=1&amp;q=veth&amp;zhida_source=entity">veth</a>，linux网桥等类似，只是另外一端连接的不一样。</p>
<ul>
<li>veth设备一端连接协议栈，另外一端连接的是veth设备</li>
<li>linux网桥一端连接协议栈，另外一端连接设备（可以是网卡，也可以是虚拟设备）</li>
</ul>
<p>而这篇文章的主角，tun/tap设备一端连接协议栈，另外一端连接<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=131959650&amp;content_type=Article&amp;match_order=1&amp;q=%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F&amp;zhida_source=entity">用户程序</a>，允许用户程序像读写文件一样进行收发数据包。</p>
</blockquote>
<h4 id="build">build</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/sonic-net/sonic-platform-vpp">https://github.com/sonic-net/sonic-platform-vpp</a></p>
<ol>
<li>
<p>git clone --recurse-submodules <a target="_blank" rel="noopener" href="https://github.com/sonic-net/sonic-buildimage.git">https://github.com/sonic-net/sonic-buildimage.git</a> 无法克隆子模块，采用<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45523675/article/details/131661935">https://blog.csdn.net/qq_45523675/article/details/131661935</a> 解决，原理是将https协议换成ssh去克隆，ssh要配置好设备上的公钥并提交到github。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-function"><span class="hljs-title">pull_submodule_recursive</span></span>()<br>&#123;<br>    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;.gitmodules&quot;</span> ];<span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;.gitmodules found&quot;</span><br>        <span class="hljs-comment"># backup</span><br>        <span class="hljs-built_in">cp</span> .gitmodules .gitmodules.bak<br>        <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line<br>        <span class="hljs-keyword">do</span><br>            <span class="hljs-comment"># substitude the https with ssh</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;line&#125;</span> | sed <span class="hljs-string">&#x27;s/https:\/\/github.com\//git@github.com:/g&#x27;</span> &gt;&gt; .new_gitmodules<br>        <span class="hljs-keyword">done</span> &lt; .gitmodules<br>        <span class="hljs-built_in">mv</span> .new_gitmodules .gitmodules<br>        <span class="hljs-comment"># pull current submodules</span><br>        git submodule init<br>        git submodule <span class="hljs-built_in">sync</span><br>        git submodule update<br>        <span class="hljs-comment"># get the directories of current submodules</span><br>        <span class="hljs-built_in">local</span> directories=$(<span class="hljs-built_in">cat</span> .gitmodules | grep path | awk <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span>)<br>        <span class="hljs-keyword">for</span> directory <span class="hljs-keyword">in</span> <span class="hljs-variable">$directories</span><br>        <span class="hljs-keyword">do</span><br>            <span class="hljs-keyword">if</span> [ -d <span class="hljs-variable">$directory</span> ];<span class="hljs-keyword">then</span><br>                <span class="hljs-comment"># enter the directory</span><br>                <span class="hljs-built_in">pushd</span> <span class="hljs-variable">$&#123;directory&#125;</span> &gt; /dev/null<br>                <span class="hljs-comment"># pull one submodule and its submodules</span><br>                pull_submodule_recursive<br>                <span class="hljs-comment"># return to the last working directory</span><br>                <span class="hljs-built_in">popd</span> &gt; /dev/null<br>            <span class="hljs-keyword">fi</span><br>        <span class="hljs-keyword">done</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;current submodule has no submodule, return to last directory...&quot;</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">return</span> 0<br>&#125;<br><br>pull_submodule_recursive<br></code></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># https://liaoxuefeng.com/books/git/remote/index.html</span><br>ssh-keygen -t rsa -C <span class="hljs-string">&quot;youremail@example.com&quot;</span><br><span class="hljs-comment"># 将~/.ssh/id_rsa.pub 下的内容提交到github</span><br>ssh -T git@github.com <span class="hljs-comment"># 验证是否成功</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>可通过以下命令确认子模块是否下载完全</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git submodule update --init --recursive<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>执行make configure PLATFORM=vpp时，make中docker在容器中update很慢，<a target="_blank" rel="noopener" href="https://blog.csdn.net/peng2hui1314/article/details/124267333">https://blog.csdn.net/peng2hui1314/article/details/124267333</a></p>
<p>添加 <code>~/.docker/config.json</code>，再重启docker，<code>sudo systemctl restart docker</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br> <span class="hljs-attr">&quot;proxies&quot;</span><span class="hljs-punctuation">:</span><br> <span class="hljs-punctuation">&#123;</span><br>   <span class="hljs-attr">&quot;default&quot;</span><span class="hljs-punctuation">:</span><br>   <span class="hljs-punctuation">&#123;</span><br>     <span class="hljs-attr">&quot;httpProxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://127.0.0.1:7890&quot;</span><span class="hljs-punctuation">,</span><br>     <span class="hljs-attr">&quot;httpsProxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://127.0.0.1:7890&quot;</span><span class="hljs-punctuation">,</span><br>     <span class="hljs-attr">&quot;noProxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;*.test.example.com,.example2.com,127.0.0.0/8&quot;</span><br>   <span class="hljs-punctuation">&#125;</span><br> <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="FRR">FRR</h2>
<p><a target="_blank" rel="noopener" href="https://docs.frrouting.org/en/latest/isisd.html#isis-interface">ISIS — FRR latest documentation (frrouting.org)</a></p>
<p>注意，以后有关FRRouting的相关内容可以去这个网站查看<a target="_blank" rel="noopener" href="https://app.slack.com/client/T4SEHL8CQ/C4TS8E59D">random（频道） - FRRouting - Slack</a>。来自<a target="_blank" rel="noopener" href="https://frrouting.org/community/">FRRouting Community – FRRouting</a></p>
<p>另一方面，多关注github的issue页面。<a target="_blank" rel="noopener" href="https://github.com/FRRouting/frr/issues">FRRouting/frr: The FRRouting Protocol Suite (github.com)</a></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231218153819693.png" srcset="/img/loading.gif" lazyload alt="image-20231218153819693"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">isis fast-reroute lfa<br>isis fast-reroute remote-lfa tunnel mpls-ldp [level-1 | level-2]<br></code></pre></td></tr></table></figure>
<h3 id="配置TI-LFA">配置TI-LFA</h3>
<h4 id="ISIS">ISIS</h4>
<p>有关TI-LFA的详细介绍<a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/doc/EDOC1100167260">Segment Routing TI-LFA FRR保护技术 - 华为 (huawei.com)</a></p>
<p>FRRouting上的配置与SR和TI相关，如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">vtysh -c <span class="hljs-string">&quot;</span><br><span class="hljs-string">config</span><br><span class="hljs-string">ro isis sonic</span><br><span class="hljs-string">is-type level-1</span><br><span class="hljs-string">net 49.0001.0000.0000.0006.00</span><br><span class="hljs-string"></span><br><span class="hljs-string">segment-routing on</span><br><span class="hljs-string">segment-routing global-block 16000 23999</span><br><span class="hljs-string">segment-routing node-msd 8</span><br><span class="hljs-string">segment-routing prefix 6.6.6.6/32 index 60</span><br><span class="hljs-string">segment-routing prefix 2001::6/128 index 61</span><br><span class="hljs-string">interface lo</span><br><span class="hljs-string">ip address 6.6.6.6/32</span><br><span class="hljs-string">ipv6 address 2001::6/128</span><br><span class="hljs-string">ip ro isis sonic</span><br><span class="hljs-string">ipv6 ro isis sonic</span><br><span class="hljs-string">isis passive</span><br><span class="hljs-string">exit</span><br><span class="hljs-string"></span><br><span class="hljs-string">interface Ethernet4</span><br><span class="hljs-string">ipv6 ro isis sonic</span><br><span class="hljs-string">ip ro isis sonic</span><br><span class="hljs-string">isis fast-reroute ti-lfa</span><br><span class="hljs-string">exit</span><br><span class="hljs-string">end</span><br><span class="hljs-string">write&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="OSPF">OSPF</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo config save -y<br>vtysh -c <span class="hljs-string">&quot;</span><br><span class="hljs-string">config</span><br><span class="hljs-string"></span><br><span class="hljs-string">interface Ethernet4</span><br><span class="hljs-string">ip ospf network point-to-point</span><br><span class="hljs-string">exit</span><br><span class="hljs-string">interface lo</span><br><span class="hljs-string">ip address 1.1.1.6/32</span><br><span class="hljs-string">ip ospf passive</span><br><span class="hljs-string">exit</span><br><span class="hljs-string"></span><br><span class="hljs-string">ro ospf</span><br><span class="hljs-string">ospf router-id 1.1.1.6</span><br><span class="hljs-string">net 20.0.0.0/8 area 0.0.0.0</span><br><span class="hljs-string">net 1.1.1.0/24 area 0.0.0.0</span><br><span class="hljs-string">area 0.0.0.0 range 20.0.0.0/8</span><br><span class="hljs-string">area 0.0.0.0 range 1.1.1.0/24</span><br><span class="hljs-string">capability opaque</span><br><span class="hljs-string">mpls-te on</span><br><span class="hljs-string">mpls-te router-address 1.1.1.6</span><br><span class="hljs-string">router-info area 0.0.0.0</span><br><span class="hljs-string">segment-routing on</span><br><span class="hljs-string">segment-routing global-block 16000 24000</span><br><span class="hljs-string">segment-routing node-msd 8</span><br><span class="hljs-string">segment-routing prefix 1.1.1.6/32 index 60</span><br><span class="hljs-string"></span><br><span class="hljs-string">end</span><br><span class="hljs-string">write&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="bgp">bgp</h3>
<p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44900668/article/details/119170147">BGP 基本配置实验（超详细）_bgp实验-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.frrouting.org/en/latest/bgp.html#clicmd-neighbor-PEER-next-hop-self-force">BGP — FRR latest documentation (frrouting.org)</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">vtysh<br>config<br>no route bgp 65100<br>route bgp ASN<br>neighbor X.X.X.X remote-as ASN   ! ebgp的ip地址和asn<br>neighbor X.X.X.X update-source Loopback0 (iBGP)  ！ibgp的loopback地址<br>neighbor X.X.X.X next-hop-self force (iBGP) !tab补不出来，得自己敲，或者进address-family ipv4模式<br>no bgp ebgp-requires-policy<br><br>！可使用peer-group简化配置  neighbor WORD peer-group<br>neighbor ibgp peer-group<br>neighbor ibgp remote-as ASN<br>neighbor ibgp update-source Loopback0<br>neighbor ibgp next-hop-self force<br>neighbor X.X.X.X peer-group ibgp<br>还有activate<br><br></code></pre></td></tr></table></figure>
<p>重启保存bgp配置[<a target="_blank" rel="noopener" href="https://support.edge-core.com/hc/en-us/articles/900000514823--Enterprise-SONiC-FRRouting-and-config-initialization">Enterprise SONiC] FRRouting and config initialization – Edgecore Help Center (edge-core.com)</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo vim /etc/sonic/config_db.json<br>1. BGP_NEIGHBOR前加<span class="hljs-string">&quot;//&quot;</span><br>2. 删除<span class="hljs-string">&quot;DEVICE_METADATA&quot;</span>中的bgp_asn一行<br>3. 在<span class="hljs-string">&quot;DEVICE_METADATA&quot;</span>添加<span class="hljs-string">&quot;docker_routing_config_mode&quot;</span>:<span class="hljs-string">&quot;split&quot;</span><br><br><br>sudo sed -i <span class="hljs-string">&#x27;s/&quot;BGP_NEIGHBOR&quot;/&quot;\/\/BGP_NEIGHBOR&quot;/g&#x27;</span> /etc/sonic/config_db.json<br>sudo sed -i <span class="hljs-string">&#x27;s/&quot;bgp_asn&quot;: &quot;65100&quot;,//g&#x27;</span> /etc/sonic/config_db.json<br>sudo sed -i <span class="hljs-string">&#x27;s/&quot;type&quot;: &quot;LeafRouter&quot;/&quot;type&quot;: &quot;LeafRouter&quot;,\n&quot;docker_routing_config_mode&quot;:&quot;split&quot;/g&#x27;</span> /etc/sonic/config_db.json<br></code></pre></td></tr></table></figure>
<ul>
<li>bgp只需转发业务路由就好了，不用转发全部区域路由，这样把bgp重分发到isis就可以解决路由黑洞问题了。</li>
</ul>
<h2 id="GNS3与vmware">GNS3与vmware</h2>
<h3 id="下载gns3">下载gns3</h3>
<p>参考<a target="_blank" rel="noopener" href="https://cn.linux-console.net/?p=22052">如何在 Ubuntu 22.04|20.04|18.04 上安装 GNS3 (linux-console.net)</a></p>
<p>其中这一步是必须的</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231120152630696.png" srcset="/img/loading.gif" lazyload alt="image-20231120152630696"></p>
<p>且命令修改如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo usermod -aG ubridge,libvirt,kvm,wireshark <span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure>
<p>全部配置完成后需要重启电脑。</p>
<h3 id="使用python下载gns3">使用python下载gns3</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt update<br>sudo apt install -y python3-pip python3-pyqt5 python3-pyqt5.qtsvg \<br>python3-pyqt5.qtwebsockets \<br>qemu qemu-kvm qemu-utils libvirt-clients libvirt-daemon-system virtinst \<br>wireshark xtightvncviewer apt-transport-https \<br>ca-certificates curl gnupg2 software-properties-common<br></code></pre></td></tr></table></figure>
<h3 id="vmware的各种连接模式">vmware的各种连接模式</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46709219/article/details/108590498">虚拟机连网（多台虚拟机互联、虚拟机与真机互联、虚拟机上网）_多台主机的虚拟机互通必须要有网络吗-CSDN博客</a></p>
<ul>
<li>
<p>桥连接模式（VMnet0）：<br>
将主机网卡与虚拟机虚拟的网卡利用虚拟网桥进行通信。在桥接的作用下，类似于把物理主机虚拟为一个交换机，所有桥接设置的虚拟机连接到这个交换机的一个接口上，物理主机也同样插在这个交换机当中，所以所有桥接下的网卡与网卡都是交换模式的，相互可以访问而不干扰。此模式下的虚拟机和自己的依赖主机共同处在同一个网段下，<a target="_blank" rel="noopener" href="http://xn--IP192-jq1hs78d92ef7jencovxea285aftbr18k.168.100.xxx">意思就是如果主机的IP是192.168.100.xxx</a>,<a target="_blank" rel="noopener" href="http://xn--IP192-4n1hig5gt8dn54bbfap00d6uvptkg1dk34f8i2ccyxb.168.100.xxx">那么虚拟机中的IP地址也将会是192.168.100.xxx</a>,如果需要联网，则网关与DNS需要与主机网卡一致。虚拟机也会占用局域网中的一个IP地址，并且可以和主机同网段的其他真实终端进行相互访问。</p>
</li>
<li>
<p>NAT模式（VMnet8)：<br>
VMware会在主机上建立单独的专用网络，用以在主机和虚拟机之间相互通信。虚拟机向外部网络发送的请求数据”包裹”，都会交由NAT网络适配器加上”特殊标记”并以主机的名义转发出去，外部网络返回的响应数据”包裹”，也是先由主机接收，然后交由NAT网络适配器根据”特殊标记”进行识别并转发给对应的虚拟机，因此，虚拟机在外部网络中不必具有自己的IP地址。从外部网络来看，虚拟机和主机在共享一个IP地址（因此，只要主机可以访问Internet虚拟机就可以访问Internet），默认情况下，外部网络终端也无法访问到虚拟机。此外，在一台主机上只允许有一个NAT模式的虚拟网络。因此，同一台主机上的多个采用NAT模式网络连接的虚拟机也是可以相互访问的，但因为NAT模式下的虚拟机不具有真实IP，所以无法和主机同网段的其他真实终端进行相互访问。</p>
</li>
<li>
<p>Host-Only模式(VMnet1)：<br>
一种比NAT模式更加封闭的的网络连接模式，它将创建完全包含在主机中的专用网络。仅主机模式的虚拟网络适配器仅对主机可见，并在虚拟机和主机系统之间提供网络连接。相对于NAT模式而言，仅主机模式不具备NAT功能，因此在默认情况下，使用仅主机模式网络连接的虚拟机无法连接到Internet(在主机上安装合适的路由或代理软件，或者在Windows系统的主机上使用Internet连接共享功能，仍然可以让虚拟机连接到Internet或其他网络)。在同一台主机上可以创建多个仅主机模式的虚拟网络，如果多个虚拟机处于同一个仅主机模式网络中，那么它们之间是可以相互通信的；如果它们处于不同的仅主机模式网络，则默认情况下无法进行相互通信(可通过在它们之间设置路由器来实现相互通信)。</p>
</li>
</ul>
<h3 id="gns3vm（ubuntu20-04）配置网卡">gns3vm（ubuntu20.04）配置网卡</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014129103/article/details/127927064">Ubuntu Server 20.04 网卡启动及配置_ubuntu20.04网卡配置_fghjkl17的博客-CSDN博客</a></p>
<ol>
<li>
<p>修改/etc/netplan/00-installer-config.yaml即可。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo vim /etc/netplan/00-installer-config.yaml<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>修改相应内容，注意yaml文件对缩进空格严格。如下，本项目中gateway4往下可以不配置。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">network:</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">ethernets:</span><br>    <span class="hljs-attr">eth0:</span><br>      <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">no</span><br>      <span class="hljs-attr">addresses:</span> [<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.2</span><span class="hljs-string">/24</span>]<br>      <span class="hljs-attr">optional:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">gateway4:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span><br>      <span class="hljs-attr">nameservers:</span><br>              <span class="hljs-attr">addresses:</span> [<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span>,<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>]<br>              <br></code></pre></td></tr></table></figure>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240302133745076.png" srcset="/img/loading.gif" lazyload alt="image-20240302133745076"></p>
</li>
<li>
<p>应用更改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo netplan apply<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="windows配置静态路由">windows配置静态路由</h3>
<ol>
<li>
<p><code>win</code>搜索powershell，管理员模式运行。</p>
</li>
<li>
<p><code>route print</code>寻找下一跳的网卡编号</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102132525764.png" srcset="/img/loading.gif" lazyload alt="image-20231102132525764"></p>
</li>
<li>
<p><code>route add</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">route add 目的ip <span class="hljs-attribute">mask</span> 掩码 下一跳 if 网卡编号 -<span class="hljs-selector-tag">p</span>   （-<span class="hljs-selector-tag">p</span>表示永久路由，否则重启该路由就没了）<br></code></pre></td></tr></table></figure>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102132612024.png" srcset="/img/loading.gif" lazyload alt="image-20231102132612024"></p>
</li>
</ol>
<h3 id="windows配置MTU">windows配置MTU</h3>
<ol>
<li>
<p><code>win</code>搜索powershell，管理员模式运行。</p>
</li>
<li>
<p>如果是windows11，还需进入网卡适配器</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231110133046953.png" srcset="/img/loading.gif" lazyload alt="image-20231110133046953"></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231110133117432.png" srcset="/img/loading.gif" lazyload alt="image-20231110133117432"></p>
<p>但只能修改为9014Bytes以下。</p>
</li>
<li>
<p>输入以下命令，查看MTU</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">netsh interface ipv4 show subinterfaces<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>输入以下命令，修改MTU</p>
</li>
</ol>
   <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">netsh interface ipv4 <span class="hljs-built_in">set</span> subinterface &quot;需修改的连接名&quot; mtu=<span class="hljs-number">9100</span> store=persistent<br></code></pre></td></tr></table></figure>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231107131449090.png" srcset="/img/loading.gif" lazyload alt="image-20231107131449090"></p>
<h3 id="配置有线连接的其他真机与本地真机的gns3vm的sonic路由通信">配置有线连接的其他真机与本地真机的gns3vm的sonic路由通信</h3>
<h4 id="配置有线连接的其他真机与本地真机">配置有线连接的其他真机与本地真机</h4>
<ol>
<li>修改对应网卡上的ipv4配置即可，另两个网卡的ip地址在同一个网段下。</li>
</ol>
<h4 id="配置本地真机与虚拟机">配置本地真机与虚拟机</h4>
<p>因为本项目是在vm上的gns3，所以要去修改vm的网络适配器，而不是在gns3的设置中去增加vmnet5,6,7…并添加到云的特殊接口上去配置（虽然可能也行，但没寻找到成功的方法）。故需要去配置vmware上的网络适配器。</p>
<ol>
<li>
<p>在vmware虚拟网络编辑器上编辑桥接模式的vmnet0，需要选择为本机网线连接的那个网卡。</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102144701101.png" srcset="/img/loading.gif" lazyload alt="image-20231102144701101"></p>
</li>
<li>
<p>在gns的虚拟机设置中增加桥接模式的网络适配器，不需要选择复制物理网络连接状态（复制物理网络连接状态是供移动端，无线网络选择的）下图已经添加好了。且注意网络适配器就是云上的eth0，而网络适配器2就是云上的eth1，以此类推。</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102145308528.png" srcset="/img/loading.gif" lazyload alt="image-20231102145308528"></p>
</li>
<li>
<p>进入gns3的命令行，按[4.2 gns3vm配置网卡](# gns3vm（ubuntu20.04）配置网卡)的方式去配置新增加的桥接模式的网卡，这里是eth2。</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231102150102198.png" srcset="/img/loading.gif" lazyload alt="image-20231102150102198"></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240325163606930.png" srcset="/img/loading.gif" lazyload alt="image-20240325163606930"></p>
</li>
<li>
<p>配置sonic路由器的相应接口ip在同一个网段。</p>
</li>
<li>
<p>大功告成，应该可以ping通了，确保防火墙是关闭的状态。</p>
</li>
</ol>
<h4 id="配置ospf或本地静态路由"><s>配置ospf或</s>本地静态路由</h4>
<ul>
<li>
<p>当本地作为服务器时，去配置gns3上的sonic路由器即可，参考<a href="#%E9%85%8D%E7%BD%AEospf">配置ospf</a>。</p>
</li>
<li>
<p>当本地作为终端时，有两种配置方法</p>
<ul>
<li>
<p>在网卡ipv4的配置中，添加默认网关。注意默认网关不是网线另一端的ip，而是网线另一端的gns3上桥接的路由器ip。</p>
</li>
<li>
<p>添加静态路由，参考<a href="#windows%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1">windows配置静态路由</a>，同样注意下一跳不是网线另一端的ip，而是网线另一端的gns3上桥接的路由器ip。如下图中下一跳是10.2.3.2，而不是10.2.3.20</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231106183417418.png" srcset="/img/loading.gif" lazyload alt="image-20231106183417418"></p>
</li>
</ul>
</li>
</ul>
<p>更新：<s>通过修改windows和vmware的MTU的方法，配置ISIS即可。当然，配置本地静态路由还是需要的。</s></p>
<p><s>参考<a href="#gns3vm%EF%BC%88ubuntu20.04%EF%BC%89%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1">gns3vm配置网卡</a>和<a href="#windows%E9%85%8D%E7%BD%AEMTU">配置windows的mtu</a></s></p>
<p>通过修改sonic路由的mtu，配置isis即可。</p>
<ol start="2">
<li></li>
</ol>
<h3 id="NAT">NAT</h3>
<p>gns3NAT自带云中所分配的ip和virbr0所属同一个网段。修改可参考下面网站</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9cce35733e00">命令行如何修改KVM生产的virbr0的地址 - 简书 (jianshu.com)</a></p>
<ol>
<li>
<p>default.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"> vim /etc/libvirt/qemu/networks/default.xml<br><span class="hljs-tag">&lt;<span class="hljs-name">network</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">uuid</span>&gt;</span>d63fbb69-44f0-4f7a-a001-af50092204e8<span class="hljs-tag">&lt;/<span class="hljs-name">uuid</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">forward</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&#x27;nat&#x27;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bridge</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;virbr0&#x27;</span> <span class="hljs-attr">stp</span>=<span class="hljs-string">&#x27;on&#x27;</span> <span class="hljs-attr">delay</span>=<span class="hljs-string">&#x27;0&#x27;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mac</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&#x27;52:54:00:36:44:41&#x27;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ip</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&#x27;192.168.122.1&#x27;</span> <span class="hljs-attr">netmask</span>=<span class="hljs-string">&#x27;255.255.255.0&#x27;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dhcp</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">range</span> <span class="hljs-attr">start</span>=<span class="hljs-string">&#x27;192.168.122.2&#x27;</span> <span class="hljs-attr">end</span>=<span class="hljs-string">&#x27;192.168.122.254&#x27;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dhcp</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ip</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">network</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>修改并生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#修改配置文件</span><br>sed -i <span class="hljs-string">&#x27;s/192.168.122/192.168.8/g&#x27;</span> /etc/libvirt/qemu/networks/default.xml<br><span class="hljs-comment">#定义网络</span><br>virsh  net-define /etc/libvirt/qemu/network/default.xml<br><span class="hljs-comment">#停止default网络</span><br>virsh  net-destroy default  <br><span class="hljs-comment">#启动default网络</span><br>virsh  net-start  default<br><span class="hljs-comment">#重启libvirtd</span><br>systemctl restart libvirtd<br></code></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<p>xml文件的相关解释</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/eac28b175161">libvirt xml文件解析 – Devices - 简书 (jianshu.com)</a></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://documentation.suse.com/zh-cn/sles/15-SP2/html/SLES-all/cha-libvirt-networks.html">SLES 15 SP2 | 虚拟化指南 | 管理网络 (suse.com)</a></p>
<p>包含 <forward> 元素表示该虚拟网络将连接到物理 LAN。<code>mode</code> 属性指定转发方法。最常用的模式为“nat”（默认模式，表示网络地址转换）、“route”（直接转发到物理网络，不执行地址转换）和“bridge”（在 <code>libvirt</code> 外部配置的网桥）。如果不指定 <forward> 元素，虚拟网络将与其他网络相隔离。有关转发模式的完整列表，请参见 <a target="_blank" rel="noopener" href="http://libvirt.org/formatnetwork.html#elementsConnect%E3%80%82">http://libvirt.org/formatnetwork.html#elementsConnect。</a></forward></forward></p>
</blockquote>
<h3 id="gns3中导入vmware虚拟机">gns3中导入vmware虚拟机</h3>
<p><a target="_blank" rel="noopener" href="https://docs.gns3.com/docs/emulators/adding-vmware-vms-to-gns3-topologies/">Adding VMware VMs to GNS3 Topologies | GNS3 Documentation</a></p>
<p>几个要点：</p>
<ol>
<li>
<p>当vmware创建时，需要勾选不使用网络连接。</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240112201139468.png" srcset="/img/loading.gif" lazyload alt="image-20240112201139468"></p>
</li>
<li>
<p>gns3导入虚拟机后，勾选下面选项。</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240112201243723.png" srcset="/img/loading.gif" lazyload alt="image-20240112201243723"></p>
</li>
<li>
<p>记得使用gns3去创建vmnet，点击下图configure。</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240112201412783.png" srcset="/img/loading.gif" lazyload alt="image-20240112201412783"></p>
</li>
<li>
<p>vmware workstation的安装位置应是默认的，这样gns3才能找到。</p>
</li>
<li>
<p>若gns3路由和vm虚拟机直连无法ping通，尝试将对应的vmnet的mtu和子网域改成一致的。</p>
</li>
</ol>
<h3 id="增加gns3vm-的内存">增加gns3vm 的内存</h3>
<p>setup wizard</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240318150055618.png" srcset="/img/loading.gif" lazyload alt="image-20240318150055618"></p>
<h3 id="解决gns3-eth0未配置">解决gns3 eth0未配置</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_37828989/article/details/112908637">GNS3 Network Emulator 使用（一）_eth0 is not configured-CSDN博客</a></p>
<h3 id="疑难杂症">疑难杂症</h3>
<ol>
<li>
<p><strong>链路已经存在</strong></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231107121044655.png" srcset="/img/loading.gif" lazyload alt="image-20231107121044655"></p>
<p>解决办法：关闭gns3再打开即可。</p>
</li>
<li>
<p>一些网上搜的linux的东西，sonic路由器上没有</p>
<p>解决办法，进入<code>/usr/bin/docker exec -it bgp /bin/bash</code>不知道叫什么模式，再试试。</p>
</li>
<li>
<p><strong>桥接好网络后，一配置isis协议就导致桥接的直连网无法ping通。</strong></p>
<p>解决方法：</p>
<p>发现通过<code>ping -s 1500 ip</code>的命令也会导致桥接的直连网无法ping通，故怀疑是MTU的设置问题，查看sonic路由上的MTU设置，进入<code>/usr/bin/docker exec -it bgp /bin/bash</code>不知道叫什么模式，输入<code>ifconfig</code>查看MTU，发现是9100，而桥接网卡的MTU是默认值1500</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231107130258825.png" srcset="/img/loading.gif" lazyload alt="image-20231107130258825"></p>
<p><s>故参照<a href="#gns3vm%EF%BC%88ubuntu20.04%EF%BC%89%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1">gns3vm配置网卡</a>，修改<code>00-installer-config.yaml</code>内容，配置MTU，如下</s></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231107130825682.png" srcset="/img/loading.gif" lazyload alt="image-20231107130825682"></p>
<p><s>同样，<code>sudo netplan apply</code>使配置生效。</s></p>
<p><s>然后也需要<a href="#windows%E9%85%8D%E7%BD%AEMTU">配置windows的mtu</a>，即这条逻辑网线上的网卡的MTU都应该是9100（以sonic路由器为准）。</s></p>
<p>以sonic路由器的9100为准会出现问题，例如有的设备无法设置mtu为9100，太大了。故使用命令去修改sonic的mtu更好</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo config inter mtu Ethernet0 1500<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>windows联网状态下怎么确定<code>10.1.2.1</code>是sonic路由器的，而不是某个公网。</p>
<p>解决方法：通过<code>ping ip -S (指定网卡ip)</code>来指定网卡发送ping包。</p>
</li>
<li>
<p>isis路由inactive</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker restart bgp  <br></code></pre></td></tr></table></figure>
</li>
<li>
<p>gns3vm的cpu利用率很高，但主机cpu利用率却不高。</p>
<p>解决方法：降低路由器vcpu的数量，太多切换线程反而浪费资源。</p>
</li>
<li>
<p>断电后gns3vm崩溃</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43567724/article/details/107213815">linux下硬盘修复：you are in emergency mode…_you are in emergency mode cdrom挂载失败-CSDN博客</a></p>
</li>
</ol>
<h2 id="linux-宿主机">linux 宿主机</h2>
<h3 id="通过网线拷贝windows文件">通过网线拷贝windows文件</h3>
<ol>
<li>
<p>配置两端ip在同一网段，能互相ping通。</p>
</li>
<li>
<p>windows中将文件设为共享，增加权限。</p>
</li>
<li>
<p>linux进行如下操作</p>
<ol>
<li>
<p>安装smbclient和cifs-utils，cifs是网络文件系统</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt install smbclient cifs-utils<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>创建挂载点，文件名可更换。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> /mnt/smb<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>挂载windows共享文件夹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mount -t cifs -o username=<span class="hljs-string">&quot;windos用户名&quot;</span>,password=<span class="hljs-string">&quot;windows密码&quot;</span> //windows_ip/共享文件路径 /mnt/smb<br></code></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li>
<p>然后即可复制文件</p>
</li>
</ol>
<h3 id="利用scp传输文件">利用scp传输文件</h3>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2292900">如何在Linux系统中使用SCP命令传输文件和文件夹？-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<h3 id="查看配置ipv4，ipv6路由">查看配置ipv4，ipv6路由</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/LJ511100/article/details/123851574">linux和windows配置IPV4/IPV6地址、静态路由、查看路由、ping命令_ipv4和ipv6怎么ping-CSDN博客</a></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240108210707405.png" srcset="/img/loading.gif" lazyload alt="image-20240108210707405"></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240108210729069.png" srcset="/img/loading.gif" lazyload alt="image-20240108210729069"></p>
<ul>
<li>
<p>驭数终端</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo ip addr add 192.168.10.103/24 dev eth1<br>sudo ip addr del 192.168.10.103/24 dev eth1<br>重启网络服务<br></code></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="重启网络服务">重启网络服务</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo service networking restart<br></code></pre></td></tr></table></figure>
<h3 id="无管理口，重启dhcp">无管理口，重启dhcp</h3>
<p>使用dhclient命令分配ip</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo dhclient eth0<br></code></pre></td></tr></table></figure>
<h3 id="修改dns">修改dns</h3>
<ol>
<li>
<p>修改配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo vim /etc/resolv.conf<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>重启网络服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo systemctl restart networking.service<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="一键换国内源">一键换国内源</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liuguanglin/p/debian11_repo.html">Debian 11 (bullseye) 国内软件源 - Guanglin - 博客园 (cnblogs.com)</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed -i <span class="hljs-string">&quot;s@http://\(deb\|security\).debian.org@https://mirrors.tencent.com@g&quot;</span> /etc/apt/sources.list<br></code></pre></td></tr></table></figure>
<p>不行换这个</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs txt">deb https://mirrors.aliyun.com/debian/ bullseye main non-free contrib<br>deb-src https://mirrors.aliyun.com/debian/ bullseye main non-free contrib<br>deb https://mirrors.aliyun.com/debian-security/ bullseye-security main<br>deb-src https://mirrors.aliyun.com/debian-security/ bullseye-security main<br>deb https://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib<br>deb-src https://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib<br>deb https://mirrors.aliyun.com/debian/ bullseye-backports main non-free contrib<br>deb-src https://mirrors.aliyun.com/debian/ bullseye-backports main non-free contrib<br></code></pre></td></tr></table></figure>
<h3 id="ubuntu16-04系统时间错误导致wifi登录认证失败">ubuntu16.04系统时间错误导致wifi登录认证失败</h3>
<p>[12.10 - How to fix wrong system time and date? - Ask Ubuntu](<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/214246/how-to-fix-wrong-system-time-and-date#:~:text=This">https://askubuntu.com/questions/214246/how-to-fix-wrong-system-time-and-date#:~:text=This</a> works for Ubuntu 16.04 Stop the ntp,if not just do sudo apt-get install ntp)</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20240415105954981.png" srcset="/img/loading.gif" lazyload alt="image-20240415105954981"></p>
<h3 id="linux内核不支持ipv6">linux内核不支持ipv6</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/5201351/p/17122078.html">关于Linux从内核启动选项中开启对ipv6的支持 - 520_1351 - 博客园 (cnblogs.com)</a></p>
<p>体现为输入<code>route -A inet6</code>命令时显示<code>not supported</code>字样。</p>
<p>解决方法：修改文件<code>/boot/grub2/grubenv</code>或<code>/boot/grub/grub.cfg</code>中的<code>ipv6.disable=1</code>为<code>ipv6.disab</code></p>
<p><code>le=0</code>。</p>
<h3 id="ipv6默认地址">ipv6默认地址</h3>
<p>ipv6默认地址（fe80开头）不能删除，会影响ipv6 isis的正常运行。fe80开头是全球单播链路地址啥的</p>
<h3 id="安装gcc，gdb，g-make">安装gcc，gdb，g++,make</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># build包含g++，gcc，make</span><br>sudo apt-get install build-essential <br>sudo apt-get install gdb<br></code></pre></td></tr></table></figure>
<h3 id="make小妙招">make小妙招</h3>
<p>可以看make install实际上执行了什么命令。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">make install --just-print<br></code></pre></td></tr></table></figure>
<h3 id="sonic-p4版本无法进行apt-get-update操作">sonic-p4版本无法进行apt-get update操作</h3>
<p>下载源已过期，更换下载源为</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">deb http://snapshot.debian.org/archive/debian/20210326T030000Z jessie main<br></code></pre></td></tr></table></figure>
<h3 id="ubuntu盒盖不休眠">ubuntu盒盖不休眠</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/aaaccc444/article/details/135211422?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-135211422-blog-114102284.235%5Ev43%5Epc_blog_bottom_relevance_base9&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=1">Ubuntu20.04-设置合上盖子电脑不熄屏，不休眠等_ubuntu设置合盖运行-CSDN博客</a></p>
<h3 id="更换python版本">更换python版本</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43744723/article/details/122090500">Ubuntu下完美切换Python版，即设置系统默认的python版本(亲测有效)_ubuntu如何使用默认python3.9-CSDN博客</a></p>
<h3 id="linux环境离线安装apt库">linux环境离线安装apt库</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># https://packages.debian.org/sid/cloud-guest-utils</span><br><span class="hljs-comment"># https://ubuntu.pkgs.org/20.04/ubuntu-universe-amd64/vlc_3.0.9.2-1_amd64.deb.html</span><br>sudo dpkg -i<br></code></pre></td></tr></table></figure>
<h3 id="linux中如何安装-deb文件">linux中如何安装.deb文件</h3>
<ol>
<li>下载Debian程序的.deb文件，例如hello.deb。</li>
<li>打开终端并切换到.deb文件所在的目录。</li>
<li>运行以下命令来安装.deb文件：<br>
<code>sudo dpkg -i hello.deb</code></li>
<li>如果出现依赖性错误，请运行以下命令来安装缺少的依赖项：<br>
<code>sudo apt-get install -f</code></li>
<li>运行程序：<br>
<code>hello</code></li>
</ol>
<h3 id="linux环境离线安装python第三方库">linux环境离线安装python第三方库</h3>
<ol>
<li><a target="_blank" rel="noopener" href="https://pypi.org/%E7%BD%91%E7%AB%99%E6%90%9C%E7%B4%A2setuptools%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%60tar.gz%60%E6%96%87%E4%BB%B6%E3%80%82">https://pypi.org/网站搜索setuptools，下载对应`tar.gz`文件。</a></li>
<li>将该文件传输到linux环境中。</li>
<li>解压：<code>tar -zxvf *.tar.gz</code></li>
<li>进入解压目录，运行命令：<code>python setup.py install</code></li>
<li>类似前四步，下载其他第三方库。需要先下载setuptools才能这样下载其他第三方库。</li>
</ol>
<h2 id="远程连接">远程连接</h2>
<h3 id="mobaXterm远程连接vnc">mobaXterm远程连接vnc</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/oushaojun2/article/details/134184994">MobaXterm使用VNC远程显示和控制ubuntu桌面_ubuntu远程工具mobaxterm连接-CSDN博客</a></p>
<h3 id="ubuntu18-04开启vnc">ubuntu18.04开启vnc</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/langyou0/article/details/107959002">Ubuntu18.04 最简单远程桌面_ubuntu18.04远程登录vnc-CSDN博客</a></p>
<h3 id="ubuntu系统下todesk无法联网">ubuntu系统下todesk无法联网</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41786546/article/details/135255189">Ubuntu系统Todesk远程控制：网络连接不上问题解决办法_ubuntu todesk 无法联网-CSDN博客</a></p>
<ol>
<li>先关闭todesk</li>
<li>命令行关闭服务：sudo systemctl stop todeskd.service</li>
<li>找到 /opt/todesk/config/todeskd.conf 这个文件，并将其删除(sudo rm -r 文件名”)，</li>
<li>命令行重新启动服务：sudo systemctl start todeskd.service</li>
<li>重新启动todesk。</li>
</ol>
<h3 id="ssh-zerotier远程连接">ssh &amp; zerotier远程连接</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/pariese/article/details/111604340">Windows 10 开启ssh服务_windows ssh-CSDN博客</a></p>
<ol>
<li>ssh需要在同一网段下连接，否则需要内网穿透（将你的个人ip暴露在互联网中）。</li>
<li>ssh有用户密码和公钥私钥两种验证方式。</li>
</ol>
<hr>
<p>想到新方法，利用蒲公英组网（这是之前打游戏的方案XD）</p>
<ol>
<li>
<p>下载蒲公英客户端<a target="_blank" rel="noopener" href="https://pgy.oray.com/download/">贝锐蒲公英软件客户端最新版官方下载，蒲公英联机组网平台软件下载 - 贝锐蒲公英官网 (oray.com)</a></p>
</li>
<li>
<p>登录账号</p>
<p>uid: 55384583:004</p>
<p>password: admin1</p>
</li>
<li>
<p>ssh连接宿主机</p>
</li>
<li>
<p>ssh连接路由器和终端</p>
</li>
</ol>
<hr>
<p>会出现ping不通但能ssh通的情况，这是防ping策略。</p>
<hr>
<p>更好的组网，免费版支持25个用户。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44928822/article/details/128777173?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-128777173-blog-119845679.235%5Ev39%5Epc_relevant_default_base&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=1">【Linux简单入门】006SSH远程连接，内网穿透_ssh 内网穿透-CSDN博客</a></p>
<ol>
<li>
<p><a target="_blank" rel="noopener" href="https://www.zerotier.com/">zerotier用户中心</a>创建用户，新建networks，获取<code>Network ID</code></p>
</li>
<li>
<p>下载客户端并加入网络</p>
<ul>
<li>
<p>windows</p>
<ol>
<li>
<p>下载zerotier[<a target="_blank" rel="noopener" href="https://www.zerotier.com/download/">Download (zerotier.com)</a>](<a target="_blank" rel="noopener" href="https://pgy.oray.com/download/">https://pgy.oray.com/download/</a>)</p>
</li>
<li>
<p>点击join new network</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20231214121742240.png" srcset="/img/loading.gif" lazyload alt="image-20231214121742240"></p>
</li>
<li>
<p>输入<code>Network ID</code></p>
</li>
</ol>
</li>
<li>
<p>linux</p>
<ol>
<li>
<p>输入以下命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 下载zerotier客户端</span><br>curl -s https://install.zerotier.com | sudo bash<br><span class="hljs-comment"># 加入刚刚创建的网络</span><br>sudo zerotier-cli <span class="hljs-built_in">join</span> b6079f73c60b1fdf<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>其他相关命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 其他命令</span><br><span class="hljs-comment"># 加入刚刚创建的网络</span><br>sudo zerotier-cli <span class="hljs-built_in">join</span> Network ID<br><span class="hljs-comment">#离开</span><br>sudo zerotier-cli leave Network ID<br><span class="hljs-comment">#连接列表</span><br>sudo zerotier-cli listnetworks<br><span class="hljs-comment"># 启动</span><br>sudo systemctl start zerotier-one.service<br><span class="hljs-comment"># 停止</span><br>sudo systemctl stop zerotier-one.service<br><span class="hljs-comment"># 打开开机自启</span><br>sudo systemctl <span class="hljs-built_in">enable</span> zerotier-one.service<br><span class="hljs-comment"># 关闭开机自启</span><br>sudo systemctl <span class="hljs-built_in">disable</span> zerotier-one.service<br></code></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<h3 id="能ping通但不能SSH">能ping通但不能SSH</h3>
<ol>
<li>检查需要SSH的机器有没有开启ssh服务，ubuntu需要下载openssh-server</li>
<li>保持mtu一致</li>
</ol>
<h2 id="QEMU">QEMU</h2>
<ol>
<li>
<p>gns3qemu命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/bin/qemu-system-x86_64 -name sonic-vs-6 -m 4096M -smp cpus=2,sockets=1 -enable-kvm -machine smm=off -boot order=d -drive file=/home/bupt/GNS3/projects/TILFA/project-files/qemu/1677e622-9ecc-40bc-a09e-3d3c4cd0f88b/hda_disk.qcow2,<span class="hljs-keyword">if</span>=virtio,index=0,media=disk,<span class="hljs-built_in">id</span>=drive0 -uuid 1677e622-9ecc-40bc-a09e-3d3c4cd0f88b -serial telnet:127.0.0.1:5011,server,nowait -monitor tcp:127.0.0.1:41753,server,nowait -net none <br>-device e1000,mac=0c:77:e6:22:00:00,netdev=gns3-0 -netdev socket,<span class="hljs-built_in">id</span>=gns3-0,udp=127.0.0.1:10117,localaddr=127.0.0.1:10116 <br>-device e1000,mac=0c:77:e6:22:00:01,netdev=gns3-1 -netdev socket,<span class="hljs-built_in">id</span>=gns3-1,udp=127.0.0.1:10119,localaddr=127.0.0.1:10118 <br>-device e1000,mac=0c:77:e6:22:00:02,netdev=gns3-2 -netdev socket,<span class="hljs-built_in">id</span>=gns3-2,udp=127.0.0.1:10121,localaddr=127.0.0.1:10120 <br>-device e1000,mac=0c:77:e6:22:00:03,netdev=gns3-3 -netdev socket,<span class="hljs-built_in">id</span>=gns3-3,udp=127.0.0.1:10123,localaddr=127.0.0.1:10122 <br>-device e1000,mac=0c:77:e6:22:00:04,netdev=gns3-4 -netdev socket,<span class="hljs-built_in">id</span>=gns3-4,udp=127.0.0.1:10125,localaddr=127.0.0.1:10124 <br>-device e1000,mac=0c:77:e6:22:00:05,netdev=gns3-5 -netdev socket,<span class="hljs-built_in">id</span>=gns3-5,udp=127.0.0.1:10127,localaddr=127.0.0.1:10126 <br>-device e1000,mac=0c:77:e6:22:00:06,netdev=gns3-6 -netdev socket,<span class="hljs-built_in">id</span>=gns3-6,udp=127.0.0.1:10129,localaddr=127.0.0.1:10128 <br>-device e1000,mac=0c:77:e6:22:00:07,netdev=gns3-7 -netdev socket,<span class="hljs-built_in">id</span>=gns3-7,udp=127.0.0.1:10131,localaddr=127.0.0.1:10130 <br>-device e1000,mac=0c:77:e6:22:00:08,netdev=gns3-8 -netdev socket,<span class="hljs-built_in">id</span>=gns3-8,udp=127.0.0.1:10133,localaddr=127.0.0.1:10132 <br>-device e1000,mac=0c:77:e6:22:00:09,netdev=gns3-9 -netdev socket,<span class="hljs-built_in">id</span>=gns3-9,udp=127.0.0.1:10135,localaddr=127.0.0.1:10134 -display none<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>多网卡qemu命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">qemu-system-x86_64 -enable-kvm -cpu host -nographic -name sonic-simulator_1 -m 2048M -smp cpus=2 -drive file=sonic-vs-2.img,index=0,media=disk,<span class="hljs-built_in">id</span>=drive0 -serial telnet:127.0.0.1:5002,server,nowait -monitor tcp:127.0.0.1:44002,server,nowait -net nic,macaddr=52:54:00:12:34:20 -net tap,script=/etc/qemu-ifup,downscript=/etc/qemu-ifdown<br><br>++ ifconfig<br>++ grep -ci br0<br>+ br0_exist_flag=2<br>+ <span class="hljs-string">&#x27;[&#x27;</span> 2 -eq 0 <span class="hljs-string">&#x27;]&#x27;</span><br>+ sudo tunctl -t tap3 -u root<br>TUNSETIFF: Device or resource busy<br>+ sudo ifconfig tap3 up<br>+ sudo brctl addif br0 tap3<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="qemu联网">qemu联网</h3>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/a985588764/article/details/129685202">如何配置 QEMU 虚拟机网络_qemu虚拟机网络配置-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cuigelasi/article/details/78417027">centos7 删除网桥和网卡_centos删除网桥-CSDN博客</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt-get install bridge-utils        <span class="hljs-comment"># 虚拟网桥工具</span><br><br>ifconfig &lt;你的网卡名称(能上网的那张)&gt; down    <span class="hljs-comment"># 首先关闭宿主机网卡接口</span><br>brctl addbr br0                     <span class="hljs-comment"># 添加名为 br0 的网桥</span><br>brctl addif br0 &lt;你的网卡名称&gt;        <span class="hljs-comment"># 在 br0 中添加一个接口</span><br>brctl stp br0 off                   <span class="hljs-comment"># 如果只有一个网桥，则关闭生成树协议</span><br>brctl setfd br0 1                   <span class="hljs-comment"># 设置 br0 的转发延迟</span><br>brctl sethello br0 1                <span class="hljs-comment"># 设置 br0 的 hello 时间</span><br>ifconfig br0 0.0.0.0 promisc up     <span class="hljs-comment"># 启用 br0 接口</span><br>ifconfig &lt;你的网卡名称&gt; 0.0.0.0 promisc up    <span class="hljs-comment"># 启用网卡接口</span><br>dhclient br0                        <span class="hljs-comment"># 从 dhcp 服务器获得 br0 的 IP 地址</span><br>brctl show br0                      <span class="hljs-comment"># 查看虚拟网桥列表</span><br>brctl showstp br0                   <span class="hljs-comment"># 查看 br0 的各接口信息</span><br><br>tunctl -t tap0 -u root              <span class="hljs-comment"># 创建一个 tap0 接口，只允许 root 用户访问</span><br>brctl addif br0 tap0                <span class="hljs-comment"># 在虚拟网桥中增加一个 tap0 接口</span><br>ifconfig tap0 0.0.0.0 promisc up    <span class="hljs-comment"># 启用 tap0 接口</span><br>brctl showstp br0                   <span class="hljs-comment"># 显示 br0 的各个接口</span><br><br>sudo iptables -t nat -A POSTROUTING -o br0 -j MASQUERADE <span class="hljs-comment">#配置NAT，否则qemu将无法ping通baidu.com，但是能解析域名。这条规则的意思是，来自 192.168.5.0/24，且从 ens33 出去的包，要进行 NAT，同时会对返回的包进行 NAT。如果只有一个子网， -s 192.168.5.0/24 可以省略。若要删除该规则，将-A 改为 -D 即可</span><br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Mculover666/article/details/105664454">Qemu连接外网的配置方法_qemu虚拟机 net访问-CSDN博客</a></p>
<h3 id="qemu配置qemu-ifup使用nat联网">qemu配置qemu-ifup使用nat联网</h3>
<p><a target="_blank" rel="noopener" href="https://wiki.qemu.org/Documentation/Networking/NAT">Documentation/Networking/NAT - QEMU</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Copyright IBM, Corp. 2010  </span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Authors:</span><br><span class="hljs-comment">#  Anthony Liguori &lt;aliguori@us.ibm.com&gt;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This work is licensed under the terms of the GNU GPL, version 2.  See</span><br><span class="hljs-comment"># the COPYING file in the top-level directory.</span><br><br><span class="hljs-comment"># Set to the name of your bridge</span><br>BRIDGE=br0<br><br><span class="hljs-comment"># Network information</span><br>NETWORK=192.168.53.0<br>NETMASK=255.255.255.0<br>GATEWAY=192.168.53.1<br>DHCPRANGE=192.168.53.2,192.168.53.254<br><br><span class="hljs-comment"># Optionally parameters to enable PXE support</span><br>TFTPROOT=<br>BOOTP=<br><br><span class="hljs-function"><span class="hljs-title">do_brctl</span></span>() &#123;<br>    brctl <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">do_ifconfig</span></span>() &#123;<br>    ifconfig <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">do_dd</span></span>() &#123;<br>    <span class="hljs-built_in">dd</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">do_iptables_restore</span></span>() &#123;<br>    iptables-restore <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">do_dnsmasq</span></span>() &#123;<br>    dnsmasq <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">check_bridge</span></span>() &#123;<br>    <span class="hljs-keyword">if</span> do_brctl show | grep <span class="hljs-string">&quot;^<span class="hljs-variable">$1</span>&quot;</span> &gt; /dev/null 2&gt; /dev/null; <span class="hljs-keyword">then</span><br>	<span class="hljs-built_in">return</span> 1<br>    <span class="hljs-keyword">else</span><br>	<span class="hljs-built_in">return</span> 0<br>    <span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">create_bridge</span></span>() &#123;<br>    do_brctl addbr <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>    do_brctl stp <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> off<br>    do_brctl setfd <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> 0<br>    do_ifconfig <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$GATEWAY</span>&quot;</span> netmask <span class="hljs-string">&quot;<span class="hljs-variable">$NETMASK</span>&quot;</span> up<br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">enable_ip_forward</span></span>() &#123;<br>    <span class="hljs-built_in">echo</span> 1 | do_dd of=/proc/sys/net/ipv4/ip_forward &gt; /dev/null<br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">add_filter_rules</span></span>() &#123;<br>do_iptables_restore &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string"># Generated by iptables-save v1.3.6 on Fri Aug 24 15:20:25 2007</span><br><span class="hljs-string">*nat</span><br><span class="hljs-string">:PREROUTING ACCEPT [61:9671]</span><br><span class="hljs-string">:POSTROUTING ACCEPT [121:7499]</span><br><span class="hljs-string">:OUTPUT ACCEPT [132:8691]</span><br><span class="hljs-string">-A POSTROUTING -s $NETWORK/$NETMASK -j MASQUERADE </span><br><span class="hljs-string">COMMIT</span><br><span class="hljs-string"># Completed on Fri Aug 24 15:20:25 2007</span><br><span class="hljs-string"># Generated by iptables-save v1.3.6 on Fri Aug 24 15:20:25 2007</span><br><span class="hljs-string">*filter</span><br><span class="hljs-string">:INPUT ACCEPT [1453:976046]</span><br><span class="hljs-string">:FORWARD ACCEPT [0:0]</span><br><span class="hljs-string">:OUTPUT ACCEPT [1605:194911]</span><br><span class="hljs-string">-A INPUT -i $BRIDGE -p tcp -m tcp --dport 67 -j ACCEPT </span><br><span class="hljs-string">-A INPUT -i $BRIDGE -p udp -m udp --dport 67 -j ACCEPT </span><br><span class="hljs-string">-A INPUT -i $BRIDGE -p tcp -m tcp --dport 53 -j ACCEPT </span><br><span class="hljs-string">-A INPUT -i $BRIDGE -p udp -m udp --dport 53 -j ACCEPT </span><br><span class="hljs-string">-A FORWARD -i $1 -o $1 -j ACCEPT </span><br><span class="hljs-string">-A FORWARD -s $NETWORK/$NETMASK -i $BRIDGE -j ACCEPT </span><br><span class="hljs-string">-A FORWARD -d $NETWORK/$NETMASK -o $BRIDGE -m state --state RELATED,ESTABLISHED -j ACCEPT </span><br><span class="hljs-string">-A FORWARD -o $BRIDGE -j REJECT --reject-with icmp-port-unreachable </span><br><span class="hljs-string">-A FORWARD -i $BRIDGE -j REJECT --reject-with icmp-port-unreachable </span><br><span class="hljs-string">COMMIT</span><br><span class="hljs-string"># Completed on Fri Aug 24 15:20:25 2007</span><br><span class="hljs-string">EOF</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">start_dnsmasq</span></span>() &#123;<br>    do_dnsmasq \<br>	--strict-order \<br>	--except-interface=lo \<br>	--interface=<span class="hljs-variable">$BRIDGE</span> \<br>	--listen-address=<span class="hljs-variable">$GATEWAY</span> \<br>	--bind-interfaces \<br>	--dhcp-range=<span class="hljs-variable">$DHCPRANGE</span> \<br>	--conf-file=<span class="hljs-string">&quot;&quot;</span> \<br>	--pid-file=/var/run/qemu-dnsmasq-<span class="hljs-variable">$BRIDGE</span>.pid \<br>	--dhcp-leasefile=/var/run/qemu-dnsmasq-<span class="hljs-variable">$BRIDGE</span>.leases \<br>	--dhcp-no-override \<br>	<span class="hljs-variable">$&#123;TFTPROOT:+&quot;--enable-tftp&quot;&#125;</span> \<br>	<span class="hljs-variable">$&#123;TFTPROOT:+&quot;--tftp-root=$TFTPROOT&quot;&#125;</span> \<br>	<span class="hljs-variable">$&#123;BOOTP:+&quot;--dhcp-boot=$BOOTP&quot;&#125;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">setup_bridge_nat</span></span>() &#123;<br>    <span class="hljs-keyword">if</span> check_bridge <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ; <span class="hljs-keyword">then</span><br>	create_bridge <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>	enable_ip_forward<br>	add_filter_rules <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>	start_dnsmasq <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">setup_bridge_vlan</span></span>() &#123;<br>    <span class="hljs-keyword">if</span> check_bridge <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ; <span class="hljs-keyword">then</span><br>	create_bridge <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>	start_dnsmasq <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br>&#125;<br><br>setup_bridge_nat <span class="hljs-string">&quot;<span class="hljs-variable">$BRIDGE</span>&quot;</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ; <span class="hljs-keyword">then</span><br>    do_ifconfig <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> 0.0.0.0 up<br>    do_brctl addif <span class="hljs-string">&quot;<span class="hljs-variable">$BRIDGE</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>
<h3 id="iperf测试">iperf测试</h3>
<p>qemu sonic eth0-eth0</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241021144217029.png" srcset="/img/loading.gif" lazyload alt="image-20241021144217029"></p>
<p>qemu sonic eth0-eth0 promisc模式下</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125155602492.png" srcset="/img/loading.gif" lazyload alt="image-20241125155602492"></p>
<p>gns3 sonic eth0-eth0</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125160521387.png" srcset="/img/loading.gif" lazyload alt="image-20241125160521387"></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125160616662.png" srcset="/img/loading.gif" lazyload alt="image-20241125160616662"></p>
<p>gns3 sonic-vpp eth0-eth0</p>
<p><a target="_blank" rel="noopener" href="https://ronnievsmith.medium.com/sonic-virtual-switch-with-fd-ios-vector-packet-processor-vpp-on-google-cloud-89f9c62f5fe3">SONiC Virtual Switch with FD.io Vector Packet Processor (VPP) on Google Cloud | by Ronnie Smith | Oct, 2024 | Medium</a></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125161215585.png" srcset="/img/loading.gif" lazyload alt="image-20241125161215585"></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125161236418.png" srcset="/img/loading.gif" lazyload alt="image-20241125161236418"></p>
<p>gns3 sonic Ethernet0-Ethernet0</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241021144643328.png" srcset="/img/loading.gif" lazyload alt="image-20241021144643328"></p>
<p>gns3 portchannel</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125110147812.png" srcset="/img/loading.gif" lazyload alt="image-20241125110147812"></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125110254727.png" srcset="/img/loading.gif" lazyload alt="image-20241125110254727"></p>
<p>gns3 连接前</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125161909767.png" srcset="/img/loading.gif" lazyload alt="image-20241125161909767"></p>
<p>连接后</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241125161943211.png" srcset="/img/loading.gif" lazyload alt="image-20241125161943211"></p>
<p>docker-sonic-p4</p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126104338519.png" srcset="/img/loading.gif" lazyload alt="image-20241126104338519"></p>
<p><img src="/2023/10/23/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20241126104149243.png" srcset="/img/loading.gif" lazyload alt="image-20241126104149243"></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%BC%80%E5%8F%91/" class="category-chain-item">开发</a>
  
  
    <span>></span>
    
  <a href="/categories/%E5%BC%80%E5%8F%91/%E8%B7%AF%E7%94%B1%E6%A0%87%E8%AF%86/" class="category-chain-item">路由标识</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/linux/" class="print-no-link">#linux</a>
      
        <a href="/tags/shell/" class="print-no-link">#shell</a>
      
        <a href="/tags/debian/" class="print-no-link">#debian</a>
      
        <a href="/tags/gns3/" class="print-no-link">#gns3</a>
      
        <a href="/tags/sonic/" class="print-no-link">#sonic</a>
      
        <a href="/tags/docker/" class="print-no-link">#docker</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>路由标识项目学习记录</div>
      <div>https://codenum137.github.io/codenum137.github.io/2023/10/23/路由标识项目学习记录/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>hey137</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年10月23日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/10/25/Go%E8%AF%AD%E8%A8%80%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/" title="Go语言简明教程">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Go语言简明教程</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/10/21/leetcode23-10/" title="leetcode23/10">
                        <span class="hidden-mobile">leetcode23/10</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"VUZA7v64z7VyTAP8IacQddb3-gzGzoHsz","appKey":"s9nmj2bQKMeENVBm24I948wx","path":"window.location.pathname","placeholder":"欢迎评论交流=v=","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"https://vuza7v64.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/code-collapse.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
